---
title: "Classifiers"
author: "Jim Perry"
date: "5/30/2022"
output: pdf_document
---

```{r Random Forest (RF)}
```

```{r Support Vector Machine (SVM)}
```

```{r Extreme Gradient Boosting (XGBoost)}
```


```{r Logistic Regression Preparations}
datasets = c("stunting", "thinness")

#dependent = 'stunting'
fileLoc = paste("C:/Users/Carmen Perry/Desktop/Colgate Stuff/Summer Research 2022/MalnutritionProject-20220523T125732Z-001/MalnutritionProject/Code/SR2022Malnutrition/Data/",dependent,".csv", sep = "")

data = read.csv(fileLoc)

#here the columns are grouped if they were one-hot encoded separately from one categorical
#column. This is necessary for univariate logistic regression analysis. This
#must be done by hand.

columns_grouped = list(c('Age'), c('HouseholdNumb'), c('NumbOldSib'), c('Young12'), c('FeverPWeek'), c('DiarrheaPWeek'), c('CoughPWeek'), c('DistLatHouse'), c('DistLatKitch'), c('WeeksDeworming'), c('Sex'), c('VaginalDeliv'), c('Csection'), c('No.Vaccine'), c('NoBCG'), c('Fever'), c('Diarrhea'), c('Cough'), c('NoTrimNails'), c('DirtyNails'), c('TrimOnce2Week'), c('TrimOnceMonth'), c('NoLatDoors'), c('Flies'), c('StoolFloor'), c('Suburban'), c('Rural'), c('NoLitMom'), c('PrimMom'), c('HSMom'), c('KitchSep'), c('KitchRoof'), c('KitchWall'), c('CookWood'), c('CookGas'), c('CookCoal'), c('CookKerosine'), c('CookElectric'), c('NoElect'), c('Radio'), c('TV'), c('Phone'), c('Cattle'), c('SheepGoat'), c('Chicken'), c('Pet'), c('None'), c('PotableWater'), c('DrinkDirect'), c('OwnLatrine'), c('Outside.Latrine'), c('Sewage'), c('Ditch'), c('River'), c('SometimesBathRiv'), c('NeverBathRiv'), c('SometimesWashCloth'), c('NeverWashCloth'), c('AlwaysDeficate'), c('SometimesDeficate'), c('AlwaysSchoolLat'), c('SometimesSchoolLat'), c('SometimesTP'), c('NeverTP'), c('SometimesWashHands'), c('NeverWashHands'), c('WaterWashHands'), c('AlwashHandsEating'), c('SometimesHandsEating'), c('WaterWashEat'), c('AlwaysSoil'), c('SometimesSoil'), c('NeverWashFruits'), c('SometimesWashFruits'), c('SometimesRawVeg'), c('AlwaysRawVeg'), c('SometimesBarefoot'), c('AlwaysBarefoot'), c('NoShoes'), c('Sandals'), c('Deworm'), c('Antibiotic'), c('Drugs'), c('Antimalarial'), c('Wheezing',
                                                  'Wheezing0y',
                                                  'Wheezing0y.1'),c('Wheeze13'),c('Wheeze412'), c('Asthma', 
  'Asthma0y',
  'Asthma0y.1'),c('NoDoctCon'), c('Rash'), c('Sneeze'), c('HayFever'), c('Colds')) 
    
responseVar = names(data[ncol(data)])
```

```{r Multivariate Logistic Regression, warning = FALSE}
for (dependent in datasets){
#this is the vector with all the columns, for multivariate analysis.
options(scipen=50)
columns = unlist(columns_grouped)
columns_formula = paste(columns, collapse = "+") 
#This code performs the multivariate logistic regressions for each outcome.
MV_logi = glm(paste(responseVar," ~ ", 
                       #list(names(dependent)),
                       columns_formula,
                       sep = ""), data = data, family = "binomial")
#summary(MV_logi)
tidy(MV_logi, exponentiate = TRUE, conf.level = 0.95) #turns logodds to odds, makes it pretty

#This code writes the results to multiple csv files.
# write.csv(cbind(attr((MV_logi$terms), "term.labels"),
#                 p.adjust(summary(MV_logi)$coefficients[1:length(columns)+1,4],
#                          method = "BH"),
#                 exp(summary(MV_logi)$coef[1:length(columns)+1]),
#                 exp(confint(MV_logi))[1:length(columns)+1, 1:2]),
#           file = paste("MVLoR",responseVar,".csv",sep=""),
#                  row.names = F)

"
P-VALUES IN .csv ARE SHIFTED ONE BLOCK DOWN; ASK AZIZ.
Doesn't want to output anything for last variable; somehow OOB.
"
write.csv(cbind(attr((MV_logi$terms), "term.labels"), #Variable names
                summary(MV_logi)$coefficients[1:length(columns)+1,4], #p-vals
                exp(summary(MV_logi)$coef[1:length(columns)+1]), #odds ratio -1
                exp(confint(MV_logi))[1:length(columns)+1, 1:2]), #OR CI
          file = paste("MVLoR_",responseVar,".csv", sep = ""), row.names = F)
}
```


```{r Univariate Logistic Regression, warning = FALSE}
for (dependent in datasets){
#This code creates blank data frames for univariate logistic regression models.
UV_logi_DF = data.frame(Variable_Name=character(),
                         C_Odds_Ratio=numeric(),
                         Conf_025=numeric(),
                         Conf_975=numeric(),
                         P_Value=numeric()
                         )

#This code performs univariate analysis (by groups), and then appends the results
#to the data frames made in the above code.
for (factor in 1:length(columns_grouped)){
  vec = unlist(columns_grouped[factor])
  factor = paste(vec,
            collapse = "+"
            )
  uni_model = glm(paste(responseVar, " ~ ", factor, sep = ""),
                      data = data,
                      family ="binomial"
                      )
  trm <- attr(uni_model$terms, "term.labels")
  for (result in 1:length(vec)){ #for each result value in returned vector
    print(result)
    uni <- c(trm[result],
                 (exp(summary(uni_model)$coef[result,][1])), #odds ratio
                 exp((confint(uni_model)[result,])), #odds ratio confidence interval
                 (summary(uni_model)$coef[result,][4]) #p-value
                 )
    UV_logi_DF[nrow(UV_logi_DF) + 1,] = uni
  }
}

#This replaces NAs with 0 (in case the probabilities could not fit to 0 or 1)
UV_logi_DF[is.na(UV_logi_DF)] <- 0
#Adjusting the p-values
UV_logi_DF$P_Value = p.adjust(UV_logi_DF$P_Value)#, method = "BH")
#This writes the results to csv files.
write.csv(UV_logi_DF,
          file = paste("UVLoR_",responseVar,".csv", sep = ""),
          row.names = FALSE)
}
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
