---
title: "Malnutrition Masterscript"
author: "Jim Perry"
date: "5/30/2022"
output: pdf_document
---
# PREPROCESSING: Preparing data from original survey for use in statistical/ML analysis.
#####
```{r Import Data}
#Reading and cleaning the original spreadsheet from the survey.
library(readxl)
library(dplyr)

SURVEY = read_excel("SURVEY.xlsx")
SURVEY = SURVEY[-1,] #First row is a misread full of NAs - drop it
SURVEY = SURVEY[,-c(35, 54, 115, 134)] #Empty columns

#Now the fun part - manually rename any weird variable names
names(SURVEY)[13] = "Class" #Which class in the grade is the child in?
names(SURVEY)[17] = "FamilySize"
names(SURVEY)[18] = "NumOldBros"
names(SURVEY)[19] = "Bros<12?"
names(SURVEY)[20] = "Vaccine"
names(SURVEY)[21] = "BCGScar"
names(SURVEY)[22] = "FeverLast2Weeks"
names(SURVEY)[23] = "FeverQuantity"
names(SURVEY)[24] = "DiarrheaLast2Weeks"
names(SURVEY)[25] = "DiarrheaQuantity"
names(SURVEY)[26] = "CoughLast2Weeks"
names(SURVEY)[27] = "CoughQuantity"
names(SURVEY)[28] = "NailsTrimmed"
names(SURVEY)[29] = "NailsDirty"
names(SURVEY)[30] = "NailTrimFrequency"
names(SURVEY)[31] = "SchoolLat"
names(SURVEY)[32] = "SchoolLatDoors"
names(SURVEY)[33] = "SchoolLatFlies"
names(SURVEY)[34] = "SchoolLatVisibleStool"
names(SURVEY)[35] = "HeardOfAL"
names(SURVEY)[36] = "HeardOfTT"
names(SURVEY)[37] = "HeardOfHW"
names(SURVEY)[38] = "HeardOfHIV"
names(SURVEY)[39] = "HeardOfWorms"
names(SURVEY)[40] = "HeardOfMalaria"
names(SURVEY)[41] = "HeardOfTB"
names(SURVEY)[42] = "HeardOfSCh"
names(SURVEY)[43] = "ToldByFam"
names(SURVEY)[44] = "ToldByHP"
names(SURVEY)[45] = "ToldByTeacher"
names(SURVEY)[46] = "ToldByMedia"
names(SURVEY)[47] = "KnowWormsSpread"
names(SURVEY)[48] = "HowKnowWormsSpread"
names(SURVEY)[49] = "KnowWormsBad"
names(SURVEY)[50] = "HowKnowWormsBad"
names(SURVEY)[51] = "KnowAvoidWorms"
names(SURVEY)[52] = "HowKnowAvoidWorms"
names(SURVEY)[53] = "WhereLive"
names(SURVEY)[54] = "Address"
names(SURVEY)[55] = "Occupation"
names(SURVEY)[56] = "MomEduc"
names(SURVEY)[57] = "HouseFloorMats"
names(SURVEY)[58] = "KitchenSeparate"
names(SURVEY)[59] = "SepKitchenMats"
names(SURVEY)[60] = "SepKitchenRoof"
names(SURVEY)[61] = "SepKitchenWall"
names(SURVEY)[62] = "SepKitchenNeither" #Should be able to get removed in 1HE
names(SURVEY)[63] = "CookWood"
names(SURVEY)[64] = "CookGas"
names(SURVEY)[65] = "CookCoal"
names(SURVEY)[66] = "CookKerosine"
names(SURVEY)[67] = "CookElectric"
names(SURVEY)[68] = "Electricity"
names(SURVEY)[69] = "Radio"
names(SURVEY)[70] = "TV"
names(SURVEY)[71] = "Phone"
names(SURVEY)[72] = "WhyPhone"
names(SURVEY)[73] = "Cattle"
names(SURVEY)[74] = "SheepGoat"
names(SURVEY)[75] = "Chicken"
names(SURVEY)[76] = "HousePet"
names(SURVEY)[77] = "NoAnimal"
names(SURVEY)[78] = "HouseHasWater"
names(SURVEY)[79] = "WhereGetWater"
names(SURVEY)[80] = "WaterTreated"
names(SURVEY)[81] = "HowTreat"
names(SURVEY)[82] = "FamLat"
names(SURVEY)[83] = "LatInside"
names(SURVEY)[84] = "LatDistanceHouse"
names(SURVEY)[85] = "LatDistanceKitchen"
names(SURVEY)[86] = "LatConnectedTo"
names(SURVEY)[87] = "RiverBathFrequency"
names(SURVEY)[88] = "RiverLaundryFrequency"
names(SURVEY)[89] = "DefecateField"
names(SURVEY)[90] = "UseSchoolLat"
names(SURVEY)[91] = "UseTP"
names(SURVEY)[92] = "WashHandsLat"
names(SURVEY)[93] = "WashHandsLatHow"
names(SURVEY)[94] = "WashHandsSoapLatFrequency"
names(SURVEY)[95] = "WashHandsEat"
names(SURVEY)[96] = "WashHandsEatHow"
names(SURVEY)[97] = "WashHandsSoapEatFrequency"
names(SURVEY)[98] = "EatSoil"
names(SURVEY)[99] = "FavFruit"
names(SURVEY)[100] = "WashFruit"
names(SURVEY)[101] = "EatRawVeg"
names(SURVEY)[102] = "WashRawVegFrequency"
names(SURVEY)[103] = "WalkBarefoot"
names(SURVEY)[104] = "HomeShoeOrSandal"
names(SURVEY)[105] = "ForWhatBarefoot"
names(SURVEY)[106] = "DewormPill"
names(SURVEY)[107] = "WhenDewormPill"
names(SURVEY)[108] = "Antibiotics"
names(SURVEY)[109] = "MostFreqFood"
names(SURVEY)[110] = "TakesMeds"
names(SURVEY)[111] = "Name/TypeOfMeds"
names(SURVEY)[112] = "AntiMalaria3Months"
names(SURVEY)[113] = "Wheezing"
names(SURVEY)[114] = "Wheezing2Yrs"
names(SURVEY)[115] = "Wheezing1Yr"
names(SURVEY)[116] = "Wheezing1YrQuantity"
names(SURVEY)[117] = "Asthma"
names(SURVEY)[118] = "Asthma2Yrs"
names(SURVEY)[119] = "Asthma1Yr"
names(SURVEY)[120] = "DocConfirmedAsthma"
names(SURVEY)[121] = "Rash"
names(SURVEY)[122] = "RashElbow"
names(SURVEY)[123] = "RashKnees"
names(SURVEY)[124] = "RashAnkles"
names(SURVEY)[125] = "RashButt"
names(SURVEY)[126] = "RashNeck"
names(SURVEY)[127] = "RashEyesEars"
names(SURVEY)[128] = "HayFever"
names(SURVEY)[129] = "HayFever2Yrs"
names(SURVEY)[130] = "HayFever1Yr"

SURVEY = SURVEY[,-c(1, 7, 8, 9)] #Don't need these columns; I forgot to remove them earlier, and doing so now would mean I'd have to re-index the >100 variable renames I just did above. No way.
```



```{r Handling NAs & Datatype Conversions, warning = FALSE}
reducedSurvey = SURVEY[,-c(44, 46, 48, 51, 64, 95, 101, 105, 107)] #Potential candidates for removal from dataset; we'll work with this, as I think these changes will end up in the final iteration.
################################################################################
#1HE "Where do you get your water from?"
tapWater = c()
WaterFromNeighbor = c()
WaterFromRiver = c()
WaterFromWell = c()
WaterFromTank = c()

for (i in 1:1036){
  if (is.na(reducedSurvey[[i, 70]])){
    tapWater[[i]] = 0
    WaterFromNeighbor[[i]] = 0
    WaterFromRiver[[i]] = 0
    WaterFromWell[[i]] = 0
    WaterFromTank[[i]] = 0
    next
  }
  if (tolower(reducedSurvey[[i, 70]]) == "tap water"){
    tapWater[[i]] = 1
    WaterFromNeighbor[[i]] = 0
    WaterFromRiver[[i]] = 0
    WaterFromWell[[i]] = 0
    WaterFromTank[[i]] = 0
  }else if (reducedSurvey[[i, 70]] == 0){
    tapWater[[i]] = 0
    WaterFromNeighbor[[i]] = 1
    WaterFromRiver[[i]] = 0
    WaterFromWell[[i]] = 0
    WaterFromTank[[i]] = 0
  }else if (reducedSurvey[[i, 70]] == 1){
    tapWater[[i]] = 0
    WaterFromNeighbor[[i]] = 0
    WaterFromRiver[[i]] = 1
    WaterFromWell[[i]] = 0
    WaterFromTank[[i]] = 0
  }else if (reducedSurvey[[i, 70]] == 2){
    tapWater[[i]] = 0
    WaterFromNeighbor[[i]] = 0
    WaterFromRiver[[i]] = 0
    WaterFromWell[[i]] = 1
    WaterFromTank[[i]] = 0
  }else if (reducedSurvey[[i, 70]] == 4){
    tapWater[[i]] = 0
    WaterFromNeighbor[[i]] = 0
    WaterFromRiver[[i]] = 0
    WaterFromWell[[i]] = 0
    WaterFromTank[[i]] = 1
  }
}
tapWater = as.numeric(as.character(tapWater))
reducedSurvey[[70]] = tapWater
names(reducedSurvey)[[70]] = "WaterFromTap"

WaterFromNeighbor = as.numeric(as.character(WaterFromNeighbor))
reducedSurvey[[117]] = WaterFromNeighbor
names(reducedSurvey)[[117]] = "WaterFromNeighbor"

WaterFromRiver = as.numeric(as.character(WaterFromRiver))
reducedSurvey[[118]] = WaterFromRiver
names(reducedSurvey)[[118]] = "WaterFromRiver"

WaterFromWell = as.numeric(as.character(WaterFromWell))
reducedSurvey[[119]] = WaterFromWell
names(reducedSurvey)[[119]] = "WaterFromWell"

WaterFromTank = as.numeric(as.character(WaterFromTank))
reducedSurvey[[120]] = WaterFromTank
names(reducedSurvey)[[120]] = "WaterFromTank"

################################################################################
#1HE Rural/Suburban/Urban split
rural = c()
urban = c()
for (i in 1:1036){
  if (is.na(reducedSurvey[[i, 46]])){
      next
  }
  neighborhood = reducedSurvey[[i, 46]]
  if(neighborhood == 0){
      urban[[i]] = 1
      rural[[i]] = 0
  }else if(neighborhood == 1){
    rural[[i]] = 1
    urban[[i]] = 0
    }
}
urban = as.numeric(as.character(urban))
reducedSurvey[[46]] = urban
names(reducedSurvey)[[46]] = "Urban"
rural = as.numeric(as.character(rural)) #Can't convert directly from double to numeric
reducedSurvey[[47]] = rural# = replace(reducedSurvey, reducedSurvey$Address, rural)
names(reducedSurvey)[[47]] = "Rural"
################################################################################
#Remove units from measurements so they can be converted to numerics
for (i in 1:1036){
  distance = reducedSurvey[[i, 75]]
  reducedSurvey[[i, 75]] = substr(distance, 1, length(distance))
  distance2 = reducedSurvey[[i, 76]]
  reducedSurvey[[i, 76]] = substr(distance2, 1, length(distance2))
  whenDeworm = reducedSurvey[[i, 96]]
  reducedSurvey[[i, 96]] = substr(whenDeworm, 1, length(whenDeworm))

}
reducedSurvey[[75]] = as.numeric(reducedSurvey[[75]]) #Can typecast directly to numeric
reducedSurvey[[76]] = as.numeric(reducedSurvey[[76]])
reducedSurvey[[96]] = as.numeric(reducedSurvey[[96]])
################################################################################
#These factors have number measurements but are of datatype "character"; simple conversion to datatype "numeric"
changeInds = c(19, 21, 23, 31:42, 50:59, 64:68, 72, 76, 77, 82:117)
for (factor in changeInds){
  reducedSurvey[[factor]] = as.numeric(reducedSurvey[[factor]])
}
################################################################################
#Drop "Class"? Doesn't seem specific enough to be useful.
reducedSurvey = reducedSurvey[, -9]
################################################################################
#Adjusting data values
#Convert "99"s in numeric factors to "Na"s for later imputation under kNN algorithm
for (sample in 1:1036){
  for (factor in 11:116) #Columns where 99s indicate "I don't know" as a possible answer
    if (is.na(reducedSurvey[[sample, factor]])){
      next
    }else if (reducedSurvey[[sample, factor]] == 99){
      reducedSurvey[[sample, factor]] = NA
    }
}

#A sample's height was misinput as 92.00 meters.
for (sample in 1:1036){
  if (reducedSurvey[[sample, 10]] == 92.00){ 
    reducedSurvey[[sample, 10]] = NA
    break
  }
}

#Impute conditional responses where "NA" implies 0
for (sample in 1:1036){
  for (factor in c(18, 20, 22, 31:41, 53, 55:58, 64:67, 71, 95, 109:113)){
    if (is.na(reducedSurvey[[sample, factor]])){
      reducedSurvey[[sample, factor]] = 0
    }
  }
}

#These columns were input as a different binary; as "NA/0" instead of "0/1"
for (sample in 1:1036){
  for (factor in c(30, 54, 63)){ 
    if (is.na(reducedSurvey[[sample, factor]])){
      reducedSurvey[[sample, factor]] = 0
    }else if (reducedSurvey[[sample, factor]] == 0){
      reducedSurvey[[sample, factor]] = 1
    }else{
      reducedSurvey[[sample, factor]] = 0
    }
  }
}

#Convert different numeric binaries 0/2 binaries into 0/1
for (sample in 1:1036){
  for (factor in c(49, 65)){
    if (is.na(reducedSurvey[[sample, factor]])){
      next
    }else if (reducedSurvey[[sample, factor]] == 2){
      reducedSurvey[[sample, factor]] = 1
    }else if (reducedSurvey[[sample, factor]] != 0){
      reducedSurvey[[sample, factor]] = NA
    }
  }
}
#CookElectric's binary is 0/4; converting into 0/1
for (sample in 1:1036){{
    if (is.na(reducedSurvey[[sample, 58]])){
      next
    }else if (reducedSurvey[[sample, 58]] == 4){
      reducedSurvey[[sample, 58]] = 1
    }else if (reducedSurvey[[sample, 58]] != 0){
      reducedSurvey[[sample, 58]] = NA
    }
  }
}
#0/3 here
for (sample in 1:1036){{
    if (is.na(reducedSurvey[[sample, 66]])){
      reducedSurvey[[sample, 66]] = 0
    }else if (reducedSurvey[[sample, 66]] == 3){
      reducedSurvey[[sample, 66]] = 1
    }else if (reducedSurvey[[sample, 6]] != 0){
      reducedSurvey[[sample, 66]] = NA
    }
  }
}
#I don't know why this code in the above loop doesn't work. I don't know why it does work when placed into its own loop. Code is mysterious; let's hope this desire for loop autonomy doesn't spread
for (sample in 1:1036){{
    if (is.na(reducedSurvey[[sample, 66]])){
      reducedSurvey[[sample, 66]] = 0
    }
  }
}

#copySet = reducedSurvey
#reducedSurvey = copySet

#Setting weird values in binary vectors (anything that's not 0/1) to NA for imputation
for (sample in 1:1036){
  for (factor in c(15, 16, 21, 23, 24, 49, 51, 58, 65, 68, 72:73)){
    if (is.na(reducedSurvey[[sample, factor]])){
      next
    }else if ((reducedSurvey[[sample, factor]] != 0) & (reducedSurvey[[sample, factor]] != 1)){
      reducedSurvey[[sample, factor]] = NA
    }
  }
}



reducedSurvey$HouseFloorMats = tolower(reducedSurvey$HouseFloorMats)

#Getting rid of some more weird values
for (sample in 1:1036){
  for (factor in c(85:86))
  if (is.na(reducedSurvey[[sample, factor]])){
    next
  }
  else if (reducedSurvey[[sample, factor]] == 21 || reducedSurvey[[sample, factor]] == 10){
    reducedSurvey[[sample, factor]] = NA
  }
}

for (sample in 1:1036){
  if (is.na(reducedSurvey[[sample, 10]])){
    next
  }
  else if (reducedSurvey[[sample, 10]] == 1.79){
    reducedSurvey[[sample, 10]] = 1.29
  }
}

```



```{r kNN, One Hot Encoding}
library(VIM)
library(fastDummies)
################################################################################
#DEAL WITH CATEGORICALS
#impute ordinal categoricals
imputed = kNN(reducedSurvey, variable = colnames(reducedSurvey), k = 5, impNA = TRUE)
imputed = subset(imputed, select = AL:WaterFromTank)

#1HE nominal categoricals
#I already encoded some of these by hand in the last code block, but the remainder can be handled by this imported function
oneHotEncoded = dummy_cols(.data = imputed,
                     ignore_na = TRUE,
                     remove_first_dummy =  TRUE,
                     split = ",")
oneHotEncoded = oneHotEncoded[,-c(48, 123)] #One category got broken up and the other was created to account for a sample answer that got misinput as both
oneHotEncoded[[843, 121]] = 1

```



```{r Final Layer of Data Handling}
#Handle variables we decided to remove or calculate differently after I wrote 300 lines of code. I'm not mad - I'm not just rewriting everything above to account for new index values.
processed = oneHotEncoded[, -c(1:5, 11, 13:14, 18, 20, 22, 25:26, 30:44, 49, 52:56, 61, 66, 70, 73:75, 83, 86, 92, 94, 99:104, 107:112, 114, 119:121, 127)]

#Encode mother's education
for (i in 1:1036){
  education = processed[[i, 19]]
  processed$momFinishedPrimary[[i]] = 0
  processed$momFinishedSecondary[[i]] = 0
  processed$momFinishedTertiary[[i]] = 0
  if (education == 1){
    processed$momFinishedPrimary[[i]] = 1
  }else if (education == 2){
    processed$momFinishedSecondary[[i]] = 1
  }else if (education == 3){
    processed$momFinishedTertiary[[i]] = 1
  }
}

processed$momFinishedPrimary = as.numeric(as.character(processed$momFinishedPrimary))
processed$momFinishedSecondary = as.numeric(as.character(processed$momFinishedSecondary))
processed$momFinishedTertiary = as.numeric(as.character(processed$momFinishedTertiary))
processed = processed[, -19]

#Convert house floor materials into a binary for whether that floor is dust or not
for (i in 1:1036){
  if (sum(processed[i,61:65]) > 0){
    processed$houseDustFloor[[i]] = 0
  }else{
    processed$houseDustFloor[[i]] = 1
  }
}
processed$houseDustFloor = as.numeric(as.character(processed$houseDustFloor))
processed = processed[,-c(61:65)]

#Converting 1/2 binaries to 0/1
for (sample in 1:1036){
  for (factor in 53:56){
    if (processed[sample, factor] == 2){
      processed[sample, factor] = 0
    }
  }
}

#Every sample has the same answer for this variable - it tells us nothing
processed = processed[,-c(21)]
processed = processed[,-3]

#1HE washing hands after lat into "never", "with water", and "with soap" groups
for (i in 1:1036){
  if (processed[[i,38]] == 2){
    processed$washHandsLatWater[[i]] = 0
    processed$washHandsLatWaterSoap[[i]] = 0
  }else{
    if (processed[[i, 39]] == 0){
      processed$washHandsLatWater[[i]] = 1
      processed$washHandsLatWaterSoap[[i]] = 0
    }else if (processed[[i, 39]] == 1){
      processed$washHandsLatWater[[i]] = 0
      processed$washHandsLatWaterSoap[[i]] = 1
    }
  }
}
processed$washHandsLatWater = as.numeric(as.character(processed$washHandsLatWater))
processed$washHandsLatWaterSoap = as.numeric(as.character(processed$washHandsLatWaterSoap))
processed = processed[, -c(38:39)]

#1HE washing hands before eat into "never", "with water", "with soap" groups
for (i in 1:1036){
  if (processed[[i,38]] == 2){
    processed$washHandsWaterB4Eat[[i]] = 0
    processed$washHandsSoapB4Eat[[i]] = 0
  }else{
    if (processed[[i, 39]] == 0){
      processed$washHandsWaterB4Eat[[i]] = 1
      processed$washHandsSoapB4Eat[[i]] = 0
    }else if (processed[[i, 39]] == 1){
      processed$washHandsWaterB4Eat[[i]] = 0
      processed$washHandsSoapB4Eat[[i]] = 1
    }
  }
}
processed$washHandsWaterB4Eat = as.numeric(as.character(processed$washHandsWaterB4Eat))
processed$washHandsSoapB4Eat = as.numeric(as.character(processed$washHandsSoapB4Eat))
processed = processed[, -c(38:39)]

#Change ternary variables into binaries based on biological significance
for (sample in 1:1036){
  for (factor in c(33:37)){
    if (processed[[sample, factor]] == 2){
      processed[[sample, factor]] = 0
    }else{
      processed[[sample, factor]] = 1
    }
  }
}
names(processed)[[33]] = "RiverBathing"
names(processed)[[34]] = "RiverLaundry"

for (sample in 1:1036){
 if (processed[[sample, 38]] == 1){
   processed[[sample, 38]] = 0
 }else{
   processed[[sample, 38]] = 1
 }
}

for (sample in 1:1036){
  if (processed[[sample, 39]] != 0){
    processed[[sample, 39]] = 0
  }else if (processed[[sample, 39]] == 0){
    processed[[sample, 39]] = 1
  }
}
names(processed)[[39]] = "NeverWashFruit"

#More ternary variables, but split differently according to biological significance
for (sample in 1:1036){
  for (factor in c(40:42)){
    if (processed[[sample, factor]] != 0){
      processed[[sample, factor]] = 1
    }else{
      processed[[sample, factor]] = 0
    }
  }
}

#This loop below does two things: it re-formats data so 0 is false and 1 is true, OR turns already-correct but useless data into correctly-encoded data (i.e. "NoPhone" and "NoWaterInHouse")
for (sample in 1:1036){
  for (factor in c(11,13,23,31,32,36,37)){
    if (processed[[sample, factor]] == 1){
      processed[[sample, factor]] = 0
    }else{
      processed[[sample, factor]] = 1
    }
  }
}
names(processed)[[11]] = "NailsNotTrimmed"
names(processed)[[13]] = "NoSchoolLatDoors"
names(processed)[[23]] = "NoPhone"
names(processed)[[28]] = "PotableWaterFromHouse"
names(processed)[[30]] = "DontTreatWater"
names(processed)[[31]] = "NoFamLat"
names(processed)[[32]] = "LatOutside"
names(processed)[[36]] = "DontUseSchoolLat"
names(processed)[[37]] = "DontUseTP"

for (i in 1:1036){
  if (processed[[i,8]] == 1 | processed[[i,9]] == 1 | processed[[i,10]] == 1){
    processed$SickLast2Weeks[i] = 1
  }else{
    processed$SickLast2Weeks[i] = 0
  }
}
processed = processed[,-c(8:10)]

for (i in 1:1036){
  if (processed[[i,8]] == 1 | processed[[i,9]] == 1) {
    processed$NailsMaintained[i] = 0
  }else{
    processed$NailsMaintained[i] = 1
  }
}
processed = processed[,-c(8:10)]

for (i in 1:1036){
  if (processed[[i,8]] == 1 | processed[[i,9]] == 1) {
    processed$SchoolLatClean[i] = 0
  }else{
    processed$SchoolLatClean[i] = 1
  }
}
processed = processed[,-c(8:9, 11)]
processed = processed[,-c(10)]

for (i in 1:1036){
  if (processed[[i,11]] == 1 | processed[[i,12]] == 1) {
    processed$"Radio/TV"[i] = 1
  }else{
    processed$"Radio/TV"[i] = 0
  }
}
processed = processed[,-c(11:12)]
processed = processed[,-11]

processed = processed[,-c(16, 18)]

for (i in 1:1036){
  if (processed[[i,18]] == 1 | processed[[i,19]] == 1) {
    processed$RiverCleaning[i] = 1
  }else{
    processed$RiverCleaning[i] = 0
  }
}
processed = processed[,-c(18,19)]

for (i in 1:1036){
  if (processed[[i,28]] == 1 | processed[[i,29]] == 1) {
    processed$OtherMeds[i] = 1
  }else{
    processed$OtherMeds[i] = 0
  }
}
processed = processed[,-c(28,29)]
processed = processed[,-28]
processed = processed[,-c(30:34)]

for (i in 1:1036){
  if (processed[[i,31]] == 1 | processed[[i,32]] == 1) {
    processed$"momFinished2Up"[i] = 1
  }else{
    processed$"momFinished2Up"[i] = 0
  }
}
processed = processed[,-c(31, 32)]
names(processed)[[12]] = "SheepGoat"
names(processed)[[39]] = "RadioTV"
```


```{r Dependent Variable Calculations}
#Derive WAZ/HAZ/BAZ for specific analysis
#WAZ: Weight-relative-to-age Z-score
#HAZ: Height-relative-to-age Z-score (WHO says unreliable for ages 11+, so ignore older kids)
#BAZ: BMI-relative-to-age Z-score

library(anthroplus)

depVars = anthroplus_zscores(sex = processed[["Sex"]]+1,
                             age_in_months = processed[["Age"]]*12,
                             weight_in_kg = processed[["weight"]],
                             height_in_cm = processed[["Height"]]*100
                             )

for (i in 1:1036){
  ZHeight = depVars$zhfa[[i]]
  processed$HAZ[[i]] = ZHeight
  processed$Stunting[[i]] = ifelse(ZHeight < -2, 1, 0 )
  
  ZBMI = depVars$zbfa[[i]]
  processed$BAZ[[i]] = ZBMI
  processed$Thinness[[i]] = ifelse (ZBMI < -2, 1, 0)
  
  if (processed[[i,"Age"]] < 11){ #scores not calculated for children 11 and up
    ZWeight = depVars$zwfa[[i]]
    processed$WAZ[[i]] = ZWeight
    processed$Wasting[[i]] = ifelse (ZWeight < -2, 1, 0)
  }else{
    processed$WAZ[[i]] = NA
    processed$Wasting[[i]] = NA
  }
}

processed$HAZ = as.numeric(as.character(processed$HAZ))
processed$Stunting = as.numeric(as.character(processed$Stunting))
processed$BAZ = as.numeric(as.character(processed$BAZ))
processed$Thinness = as.numeric(as.character(processed$Thinness))

#Some samples were too old/young for the WHO's package to calculate Stunting scores; we will remove them
for (i in 1:1036){
  if (is.na(processed$Stunting[i])){
    processed = processed[-i,]
  }
}
#as.numeric(as.character(badAges))
#processed = processed[[-badAges,]]
```



```{r Saving Preprocessing}
stunting = processed[,-c(3, 4, 43, 45:48)]
thinness = processed[,-c(3, 4, 43:45, 47:48)]
wasting = processed[,-c(3, 4, 43:47)]
wasting = subset(wasting, Age < 11)
wasting$Wasting = as.numeric(as.character(wasting$Wasting))
################################################################################
stuntingUrban = subset(stunting, Urban == 1)
stuntingNotUrban = subset(stunting, Urban == 0)
stuntingMale = subset(stunting, Sex == 0)
stuntingFemale = subset(stunting, Sex == 1)
stuntingYouth = subset(stunting, Age < 11)
stuntingAdolescent = subset(stunting, Age > 10)
StuntingFull = stunting

thinnessUrban = subset(thinness, Urban == 1)
thinnessNotUrban = subset(thinness, Urban == 0)
thinnessMale = subset(thinness, Sex == 0)
thinnessFemale = subset(thinness, Sex == 1)
thinnessYouth = subset(thinness, Age < 11)
thinnessAdolescent = subset(thinness, Age > 10)
ThinnessFull = thinness

wastingUrban = subset(wasting, Urban == 1)
wastingNotUrban = subset(wasting, Urban == 0)
wastingMale = subset(wasting, Sex == 0)
wastingFemale = subset(wasting, Sex == 1)
WastingFull = wasting
#No Youth/Adolescent splits for Wasting; it's already limited to samples < 11 years old
################################################################################
# write.csv(stunting, "stunting.csv", row.names = FALSE)
# write.csv(thinness, "thinness.csv", row.names = FALSE)
# write.csv(wasting, "wasting.csv", row.names = FALSE)
```

# TRAIN/TEST SPLITS: Prepares train/test splits for use in feature selection and
# classifier model training. Each dependent variable (Stunting and Thinness)
# will be cloned; one clone will remain as-is (unbalanced), and the other will
# be balanced via SMOTE for (hopefully) improved classifier results.
#####

```{r Read Data}
# stunting = read.csv("stunting.csv")
# thinness = read.csv("thinness.csv")
# wasting = read.csv("wasting.csv")
```


```{r Stunting Train/Test Splits}
library(caret)
library(tidyverse)
library(smotefamily)

set.seed(13)
testFolds = createFolds(stunting$Stunting, k = 10) #Create k splits
testSetsStunting = list(stunting[testFolds$Fold01, ], stunting[testFolds$Fold02, ],
                        stunting[testFolds$Fold03, ], stunting[testFolds$Fold04, ],
                        stunting[testFolds$Fold05, ], stunting[testFolds$Fold06, ],
                        stunting[testFolds$Fold07, ], stunting[testFolds$Fold08, ],
                        stunting[testFolds$Fold09, ], stunting[testFolds$Fold10, ]
                        )
sansTestStunting = list(stunting[-testFolds$Fold01, ], stunting[-testFolds$Fold02, ],
                        stunting[-testFolds$Fold03, ], stunting[-testFolds$Fold04, ],
                        stunting[-testFolds$Fold05, ], stunting[-testFolds$Fold06, ],
                        stunting[-testFolds$Fold07, ], stunting[-testFolds$Fold08, ],
                        stunting[-testFolds$Fold09, ], stunting[-testFolds$Fold10, ]
                        )
UBStunting = list()
validSetsStunting = list()
for (i in 1:10){
  curSet = sansTestStunting[[i]]
  validationFolds = createFolds(sansTestStunting[[i]]$Stunting, k = 10)
  validSetsStunting[[i]] = validationFolds
  UBStunting[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEStunting = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEStunting[[i]] = list()
  for (j in 1:10){
    SMOTEStunting[[i]][[j]] = SMOTE(X = as.data.frame(UBStunting[[i]][[j]]),
                              target = UBStunting[[i]][[j]]$Stunting,
                              K = 5,
                              dup_size = 1
                              )
     SMOTEStunting[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBStunting[[1]][[1]]$Stunting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'Stunting Training Set Class Distribution (Unbalanced)')
abline(h = 0)

barplot(prop.table(table(SMOTEStunting[[1]][[1]]$data$Stunting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'Stunting Training Set Class Distribution (SMOTE)')
abline(h = 0)
################################################################################
table(UBStunting[[1]][[1]]$Stunting)[[1]][[1]]
table(UBStunting[[1]][[1]]$Stunting)[[2]][[1]]
table(UBStunting[[1]][[1]]$Stunting)[[1]][[1]]/table(UBStunting[[1]][[1]]$Stunting)[[2]][[1]]
table(SMOTEStunting[[1]][[1]]$data$Stunting)[[1]][[1]]
table(SMOTEStunting[[1]][[1]]$data$Stunting)[[2]][[1]]
table(SMOTEStunting[[1]][[1]]$data$Stunting)[[1]][[1]]/table(SMOTEStunting[[1]][[1]]$data$Stunting)[[2]][[1]]
```



```{r StuntingMale}
set.seed(13)
testFolds = createFolds(stuntingMale$Stunting, k = 10) #Create k splits
testSetsStuntingMale = list(stuntingMale[testFolds$Fold01, ], stuntingMale[testFolds$Fold02, ],
                        stuntingMale[testFolds$Fold03, ], stuntingMale[testFolds$Fold04, ],
                        stuntingMale[testFolds$Fold05, ], stuntingMale[testFolds$Fold06, ],
                        stuntingMale[testFolds$Fold07, ], stuntingMale[testFolds$Fold08, ],
                        stuntingMale[testFolds$Fold09, ], stuntingMale[testFolds$Fold10, ]
                        )
sansTestStuntingMale = list(stuntingMale[-testFolds$Fold01, ], stuntingMale[-testFolds$Fold02, ],
                        stuntingMale[-testFolds$Fold03, ], stuntingMale[-testFolds$Fold04, ],
                        stuntingMale[-testFolds$Fold05, ], stuntingMale[-testFolds$Fold06, ],
                        stuntingMale[-testFolds$Fold07, ], stuntingMale[-testFolds$Fold08, ],
                        stuntingMale[-testFolds$Fold09, ], stuntingMale[-testFolds$Fold10, ]
                        )
UBStuntingMale = list()
validSetsStuntingMale = list()
for (i in 1:10){
  curSet = sansTestStuntingMale[[i]]
  validationFolds = createFolds(sansTestStuntingMale[[i]]$Stunting, k = 10)
  validSetsStuntingMale[[i]] = validationFolds
  UBStuntingMale[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEStuntingMale = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEStuntingMale[[i]] = list()
  for (j in 1:10){
    SMOTEStuntingMale[[i]][[j]] = SMOTE(X = as.data.frame(UBStuntingMale[[i]][[j]]),
                              target = UBStuntingMale[[i]][[j]]$Stunting,
                              K = 5,
                              dup_size = 1
                              )
     SMOTEStuntingMale[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBStuntingMale[[1]][[1]]$Stunting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'StuntingMale Training Set Class Distribution (Unbalanced)')
abline(h = 0)

barplot(prop.table(table(SMOTEStuntingMale[[1]][[1]]$data$Stunting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'StuntingMale Training Set Class Distribution (SMOTE)')
abline(h = 0)
################################################################################
table(UBStuntingMale[[1]][[1]]$Stunting)[[1]][[1]]
table(UBStuntingMale[[1]][[1]]$Stunting)[[2]][[1]]
table(UBStuntingMale[[1]][[1]]$Stunting)[[1]][[1]]/table(UBStuntingMale[[1]][[1]]$Stunting)[[2]][[1]]
table(SMOTEStuntingMale[[1]][[1]]$data$Stunting)[[1]][[1]]
table(SMOTEStuntingMale[[1]][[1]]$data$Stunting)[[2]][[1]]
table(SMOTEStuntingMale[[1]][[1]]$data$Stunting)[[1]][[1]]/table(SMOTEStuntingMale[[1]][[1]]$data$Stunting)[[2]][[1]]
```



```{r StuntingFemale}
set.seed(13)
################################################################################
testFolds = createFolds(stuntingFemale$Stunting, k = 10) #Create k splits
testSetsStuntingFemale = list(stuntingFemale[testFolds$Fold01, ], stuntingFemale[testFolds$Fold02, ],
                        stuntingFemale[testFolds$Fold03, ], stuntingFemale[testFolds$Fold04, ],
                        stuntingFemale[testFolds$Fold05, ], stuntingFemale[testFolds$Fold06, ],
                        stuntingFemale[testFolds$Fold07, ], stuntingFemale[testFolds$Fold08, ],
                        stuntingFemale[testFolds$Fold09, ], stuntingFemale[testFolds$Fold10, ]
                        )
sansTestStuntingFemale = list(stuntingFemale[-testFolds$Fold01, ], stuntingFemale[-testFolds$Fold02, ],
                        stuntingFemale[-testFolds$Fold03, ], stuntingFemale[-testFolds$Fold04, ],
                        stuntingFemale[-testFolds$Fold05, ], stuntingFemale[-testFolds$Fold06, ],
                        stuntingFemale[-testFolds$Fold07, ], stuntingFemale[-testFolds$Fold08, ],
                        stuntingFemale[-testFolds$Fold09, ], stuntingFemale[-testFolds$Fold10, ]
                        )
UBStuntingFemale = list()
validSetsStuntingFemale = list()
for (i in 1:10){
  curSet = sansTestStuntingFemale[[i]]
  validationFolds = createFolds(sansTestStuntingFemale[[i]]$Stunting, k = 10)
  validSetsStuntingFemale[[i]] = validationFolds
  UBStuntingFemale[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEStuntingFemale = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEStuntingFemale[[i]] = list()
  for (j in 1:10){
    SMOTEStuntingFemale[[i]][[j]] = SMOTE(X = as.data.frame(UBStuntingFemale[[i]][[j]]),
                              target = UBStuntingFemale[[i]][[j]]$Stunting,
                              K = 5,
                              dup_size = 1
                              )
     SMOTEStuntingFemale[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBStuntingFemale[[1]][[1]]$Stunting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'StuntingFemale Training Set Class Distribution (Unbalanced)')
abline(h = 0)

barplot(prop.table(table(SMOTEStuntingFemale[[1]][[1]]$data$Stunting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'StuntingFemale Training Set Class Distribution (SMOTE)')
abline(h = 0)
################################################################################
table(UBStuntingFemale[[1]][[1]]$Stunting)[[1]][[1]]
table(UBStuntingFemale[[1]][[1]]$Stunting)[[2]][[1]]
table(UBStuntingFemale[[1]][[1]]$Stunting)[[1]][[1]]/table(UBStuntingFemale[[1]][[1]]$Stunting)[[2]][[1]]
table(SMOTEStuntingFemale[[1]][[1]]$data$Stunting)[[1]][[1]]
table(SMOTEStuntingFemale[[1]][[1]]$data$Stunting)[[2]][[1]]
table(SMOTEStuntingFemale[[1]][[1]]$data$Stunting)[[1]][[1]]/table(SMOTEStuntingFemale[[1]][[1]]$data$Stunting)[[2]][[1]]
```

``` {r }
set.seed(13)
################################################################################
testFolds = createFolds(stuntingUrban$Stunting, k = 10) #Create k splits
testSetsStuntingUrban = list(stuntingUrban[testFolds$Fold01, ], stuntingUrban[testFolds$Fold02, ],
                        stuntingUrban[testFolds$Fold03, ], stuntingUrban[testFolds$Fold04, ],
                        stuntingUrban[testFolds$Fold05, ], stuntingUrban[testFolds$Fold06, ],
                        stuntingUrban[testFolds$Fold07, ], stuntingUrban[testFolds$Fold08, ],
                        stuntingUrban[testFolds$Fold09, ], stuntingUrban[testFolds$Fold10, ]
                        )
sansTestStuntingUrban = list(stuntingUrban[-testFolds$Fold01, ], stuntingUrban[-testFolds$Fold02, ],
                        stuntingUrban[-testFolds$Fold03, ], stuntingUrban[-testFolds$Fold04, ],
                        stuntingUrban[-testFolds$Fold05, ], stuntingUrban[-testFolds$Fold06, ],
                        stuntingUrban[-testFolds$Fold07, ], stuntingUrban[-testFolds$Fold08, ],
                        stuntingUrban[-testFolds$Fold09, ], stuntingUrban[-testFolds$Fold10, ]
                        )
UBStuntingUrban = list()
validSetsStuntingUrban = list()
for (i in 1:10){
  curSet = sansTestStuntingUrban[[i]]
  validationFolds = createFolds(sansTestStuntingUrban[[i]]$Stunting, k = 10)
  validSetsStuntingUrban[[i]] = validationFolds
  UBStuntingUrban[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEStuntingUrban = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEStuntingUrban[[i]] = list()
  for (j in 1:10){
    SMOTEStuntingUrban[[i]][[j]] = SMOTE(X = as.data.frame(UBStuntingUrban[[i]][[j]]),
                              target = UBStuntingUrban[[i]][[j]]$Stunting,
                              K = 5,
                              dup_size = 0
                              )
     SMOTEStuntingUrban[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBStuntingUrban[[1]][[1]]$Stunting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'StuntingUrban Training Set Class Distribution (Unbalanced)')
abline(h = 0)

barplot(prop.table(table(SMOTEStuntingUrban[[1]][[1]]$data$Stunting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'StuntingUrban Training Set Class Distribution (SMOTE)')
abline(h = 0)
################################################################################
table(UBStuntingUrban[[1]][[1]]$Stunting)[[1]][[1]]
table(UBStuntingUrban[[1]][[1]]$Stunting)[[2]][[1]]
table(UBStuntingUrban[[1]][[1]]$Stunting)[[1]][[1]]/table(UBStuntingUrban[[1]][[1]]$Stunting)[[2]][[1]]
table(SMOTEStuntingUrban[[1]][[1]]$data$Stunting)[[1]][[1]]
table(SMOTEStuntingUrban[[1]][[1]]$data$Stunting)[[2]][[1]]
table(SMOTEStuntingUrban[[1]][[1]]$data$Stunting)[[1]][[1]]/table(SMOTEStuntingUrban[[1]][[1]]$data$Stunting)[[2]][[1]]
```

```{r }
set.seed(13)
################################################################################
testFolds = createFolds(stuntingNotUrban$Stunting, k = 10) #Create k splits
testSetsStuntingNotUrban = list(stuntingNotUrban[testFolds$Fold01, ], stuntingNotUrban[testFolds$Fold02, ],
                        stuntingNotUrban[testFolds$Fold03, ], stuntingNotUrban[testFolds$Fold04, ],
                        stuntingNotUrban[testFolds$Fold05, ], stuntingNotUrban[testFolds$Fold06, ],
                        stuntingNotUrban[testFolds$Fold07, ], stuntingNotUrban[testFolds$Fold08, ],
                        stuntingNotUrban[testFolds$Fold09, ], stuntingNotUrban[testFolds$Fold10, ]
                        )
sansTestStuntingNotUrban = list(stuntingNotUrban[-testFolds$Fold01, ], stuntingNotUrban[-testFolds$Fold02, ],
                        stuntingNotUrban[-testFolds$Fold03, ], stuntingNotUrban[-testFolds$Fold04, ],
                        stuntingNotUrban[-testFolds$Fold05, ], stuntingNotUrban[-testFolds$Fold06, ],
                        stuntingNotUrban[-testFolds$Fold07, ], stuntingNotUrban[-testFolds$Fold08, ],
                        stuntingNotUrban[-testFolds$Fold09, ], stuntingNotUrban[-testFolds$Fold10, ]
                        )
UBStuntingNotUrban = list()
validSetsStuntingNotUrban = list()
for (i in 1:10){
  curSet = sansTestStuntingNotUrban[[i]]
  validationFolds = createFolds(sansTestStuntingNotUrban[[i]]$Stunting, k = 10)
  validSetsStuntingNotUrban[[i]] = validationFolds
  UBStuntingNotUrban[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEStuntingNotUrban = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEStuntingNotUrban[[i]] = list()
  for (j in 1:10){
    SMOTEStuntingNotUrban[[i]][[j]] = SMOTE(X = as.data.frame(UBStuntingNotUrban[[i]][[j]]),
                              target = UBStuntingNotUrban[[i]][[j]]$Stunting,
                              K = 5,
                              dup_size = 0
                              )
     SMOTEStuntingNotUrban[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBStuntingNotUrban[[1]][[1]]$Stunting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'StuntingNotUrban Training Set Class Distribution (Unbalanced)')
abline(h = 0)

barplot(prop.table(table(SMOTEStuntingNotUrban[[1]][[1]]$data$Stunting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'StuntingNotUrban Training Set Class Distribution (SMOTE)')
abline(h = 0)
################################################################################
table(UBStuntingNotUrban[[1]][[1]]$Stunting)[[1]][[1]]
table(UBStuntingNotUrban[[1]][[1]]$Stunting)[[2]][[1]]
table(UBStuntingNotUrban[[1]][[1]]$Stunting)[[1]][[1]]/table(UBStuntingNotUrban[[1]][[1]]$Stunting)[[2]][[1]]
table(SMOTEStuntingNotUrban[[1]][[1]]$data$Stunting)[[1]][[1]]
table(SMOTEStuntingNotUrban[[1]][[1]]$data$Stunting)[[2]][[1]]
table(SMOTEStuntingNotUrban[[1]][[1]]$data$Stunting)[[1]][[1]]/table(SMOTEStuntingNotUrban[[1]][[1]]$data$Stunting)[[2]][[1]]
```



```{r StuntingYouth Train/Test Splits}
library(caret)
library(tidyverse)
library(smotefamily)

set.seed(13)
testFolds = createFolds(stuntingYouth$Stunting, k = 10) #Create k splits
testSetsStuntingYouth = list(stuntingYouth[testFolds$Fold01, ], stuntingYouth[testFolds$Fold02, ],
                        stuntingYouth[testFolds$Fold03, ], stuntingYouth[testFolds$Fold04, ],
                        stuntingYouth[testFolds$Fold05, ], stuntingYouth[testFolds$Fold06, ],
                        stuntingYouth[testFolds$Fold07, ], stuntingYouth[testFolds$Fold08, ],
                        stuntingYouth[testFolds$Fold09, ], stuntingYouth[testFolds$Fold10, ]
                        )
sansTestStuntingYouth = list(stuntingYouth[-testFolds$Fold01, ], stuntingYouth[-testFolds$Fold02, ],
                        stuntingYouth[-testFolds$Fold03, ], stuntingYouth[-testFolds$Fold04, ],
                        stuntingYouth[-testFolds$Fold05, ], stuntingYouth[-testFolds$Fold06, ],
                        stuntingYouth[-testFolds$Fold07, ], stuntingYouth[-testFolds$Fold08, ],
                        stuntingYouth[-testFolds$Fold09, ], stuntingYouth[-testFolds$Fold10, ]
                        )
UBStuntingYouth = list()
validSetsStuntingYouth = list()
for (i in 1:10){
  curSet = sansTestStuntingYouth[[i]]
  validationFolds = createFolds(sansTestStuntingYouth[[i]]$Stunting, k = 10)
  validSetsStuntingYouth[[i]] = validationFolds
  UBStuntingYouth[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEStuntingYouth = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEStuntingYouth[[i]] = list()
  for (j in 1:10){
    SMOTEStuntingYouth[[i]][[j]] = SMOTE(X = as.data.frame(UBStuntingYouth[[i]][[j]]),
                              target = UBStuntingYouth[[i]][[j]]$Stunting,
                              K = 5,
                              dup_size = 1
                              )
     SMOTEStuntingYouth[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBStuntingYouth[[1]][[1]]$Stunting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'StuntingYouth Training Set Class Distribution (Unbalanced)')
abline(h = 0)

barplot(prop.table(table(SMOTEStuntingYouth[[1]][[1]]$data$Stunting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'StuntingYouth Training Set Class Distribution (SMOTE)')
abline(h = 0)
################################################################################
table(UBStuntingYouth[[1]][[1]]$Stunting)[[1]][[1]]
table(UBStuntingYouth[[1]][[1]]$Stunting)[[2]][[1]]
table(UBStuntingYouth[[1]][[1]]$Stunting)[[1]][[1]]/table(UBStuntingYouth[[1]][[1]]$Stunting)[[2]][[1]]
table(SMOTEStuntingYouth[[1]][[1]]$data$Stunting)[[1]][[1]]
table(SMOTEStuntingYouth[[1]][[1]]$data$Stunting)[[2]][[1]]
table(SMOTEStuntingYouth[[1]][[1]]$data$Stunting)[[1]][[1]]/table(SMOTEStuntingYouth[[1]][[1]]$data$Stunting)[[2]][[1]]
```




```{r StuntingAdolescent Train/Test Splits}
library(caret)
library(tidyverse)
library(smotefamily)

set.seed(13)
testFolds = createFolds(stuntingAdolescent$Stunting, k = 10) #Create k splits
testSetsStuntingAdolescent = list(stuntingAdolescent[testFolds$Fold01, ], stuntingAdolescent[testFolds$Fold02, ],
                        stuntingAdolescent[testFolds$Fold03, ], stuntingAdolescent[testFolds$Fold04, ],
                        stuntingAdolescent[testFolds$Fold05, ], stuntingAdolescent[testFolds$Fold06, ],
                        stuntingAdolescent[testFolds$Fold07, ], stuntingAdolescent[testFolds$Fold08, ],
                        stuntingAdolescent[testFolds$Fold09, ], stuntingAdolescent[testFolds$Fold10, ]
                        )
sansTestStuntingAdolescent = list(stuntingAdolescent[-testFolds$Fold01, ], stuntingAdolescent[-testFolds$Fold02, ],
                        stuntingAdolescent[-testFolds$Fold03, ], stuntingAdolescent[-testFolds$Fold04, ],
                        stuntingAdolescent[-testFolds$Fold05, ], stuntingAdolescent[-testFolds$Fold06, ],
                        stuntingAdolescent[-testFolds$Fold07, ], stuntingAdolescent[-testFolds$Fold08, ],
                        stuntingAdolescent[-testFolds$Fold09, ], stuntingAdolescent[-testFolds$Fold10, ]
                        )
UBStuntingAdolescent = list()
validSetsStuntingAdolescent = list()
for (i in 1:10){
  curSet = sansTestStuntingAdolescent[[i]]
  validationFolds = createFolds(sansTestStuntingAdolescent[[i]]$Stunting, k = 10)
  validSetsStuntingAdolescent[[i]] = validationFolds
  UBStuntingAdolescent[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEStuntingAdolescent = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEStuntingAdolescent[[i]] = list()
  for (j in 1:10){
    SMOTEStuntingAdolescent[[i]][[j]] = SMOTE(X = as.data.frame(UBStuntingAdolescent[[i]][[j]]),
                              target = UBStuntingAdolescent[[i]][[j]]$Stunting,
                              K = 5,
                              dup_size = 1
                              )
     SMOTEStuntingAdolescent[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBStuntingAdolescent[[1]][[1]]$Stunting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'StuntingAdolescent Training Set Class Distribution (Unbalanced)')
abline(h = 0)

barplot(prop.table(table(SMOTEStuntingAdolescent[[1]][[1]]$data$Stunting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'StuntingAdolescent Training Set Class Distribution (SMOTE)')
abline(h = 0)
################################################################################
table(UBStuntingAdolescent[[1]][[1]]$Stunting)[[1]][[1]]
table(UBStuntingAdolescent[[1]][[1]]$Stunting)[[2]][[1]]
table(UBStuntingAdolescent[[1]][[1]]$Stunting)[[1]][[1]]/table(UBStuntingAdolescent[[1]][[1]]$Stunting)[[2]][[1]]
table(SMOTEStuntingAdolescent[[1]][[1]]$data$Stunting)[[1]][[1]]
table(SMOTEStuntingAdolescent[[1]][[1]]$data$Stunting)[[2]][[1]]
table(SMOTEStuntingAdolescent[[1]][[1]]$data$Stunting)[[1]][[1]]/table(SMOTEStuntingAdolescent[[1]][[1]]$data$Stunting)[[2]][[1]]
```


```{r Thinness Train/Test Splits}
library(caret)
library(tidyverse)
library(smotefamily)

set.seed(13)
testFolds = createFolds(thinness$Thinness, k = 10) #Create k splits
testSetsThinness = list(thinness[testFolds$Fold01, ], thinness[testFolds$Fold02, ],
                        thinness[testFolds$Fold03, ], thinness[testFolds$Fold04, ],
                        thinness[testFolds$Fold05, ], thinness[testFolds$Fold06, ],
                        thinness[testFolds$Fold07, ], thinness[testFolds$Fold08, ],
                        thinness[testFolds$Fold09, ], thinness[testFolds$Fold10, ]
                        )
sansTestThinness = list(thinness[-testFolds$Fold01, ], thinness[-testFolds$Fold02, ],
                        thinness[-testFolds$Fold03, ], thinness[-testFolds$Fold04, ],
                        thinness[-testFolds$Fold05, ], thinness[-testFolds$Fold06, ],
                        thinness[-testFolds$Fold07, ], thinness[-testFolds$Fold08, ],
                        thinness[-testFolds$Fold09, ], thinness[-testFolds$Fold10, ]
                        )
UBThinness = list()
validSetsThinness = list()
for (i in 1:10){
  curSet = sansTestThinness[[i]]
  validationFolds = createFolds(sansTestThinness[[i]]$Thinness, k = 10)
  validSetsThinness[[i]] = validationFolds
  UBThinness[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEThinness = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEThinness[[i]] = list()
  for (j in 1:10){
    SMOTEThinness[[i]][[j]] = SMOTE(X = as.data.frame(UBThinness[[i]][[j]]),
                              target = UBThinness[[i]][[j]]$Thinness,
                              K = 5,
                              dup_size = 9
                              )
     SMOTEThinness[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBThinness[[1]][[1]]$Thinness)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'Thinness Training Set Class Distribution (Unbalanced)')
abline(h = 0)

barplot(prop.table(table(SMOTEThinness[[1]][[1]]$data$Thinness)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'Thinness Training Set Class Distribution (SMOTE)')
abline(h = 0)
################################################################################
table(UBThinness[[1]][[1]]$Thinness)[[1]][[1]]
table(UBThinness[[1]][[1]]$Thinness)[[2]][[1]]
table(UBThinness[[1]][[1]]$Thinness)[[1]][[1]]/table(UBThinness[[1]][[1]]$Thinness)[[2]][[1]]
table(SMOTEThinness[[1]][[1]]$data$Thinness)[[1]][[1]]
table(SMOTEThinness[[1]][[1]]$data$Thinness)[[2]][[1]]
table(SMOTEThinness[[1]][[1]]$data$Thinness)[[1]][[1]]/table(SMOTEThinness[[1]][[1]]$data$Thinness)[[2]][[1]]
```



``` {r }
set.seed(13)
################################################################################
testFolds = createFolds(thinnessMale$Thinness, k = 10) #Create k splits
testSetsThinnessMale = list(thinnessMale[testFolds$Fold01, ], thinnessMale[testFolds$Fold02, ],
                        thinnessMale[testFolds$Fold03, ], thinnessMale[testFolds$Fold04, ],
                        thinnessMale[testFolds$Fold05, ], thinnessMale[testFolds$Fold06, ],
                        thinnessMale[testFolds$Fold07, ], thinnessMale[testFolds$Fold08, ],
                        thinnessMale[testFolds$Fold09, ], thinnessMale[testFolds$Fold10, ]
                        )
sansTestThinnessMale = list(thinnessMale[-testFolds$Fold01, ], thinnessMale[-testFolds$Fold02, ],
                        thinnessMale[-testFolds$Fold03, ], thinnessMale[-testFolds$Fold04, ],
                        thinnessMale[-testFolds$Fold05, ], thinnessMale[-testFolds$Fold06, ],
                        thinnessMale[-testFolds$Fold07, ], thinnessMale[-testFolds$Fold08, ],
                        thinnessMale[-testFolds$Fold09, ], thinnessMale[-testFolds$Fold10, ]
                        )
UBThinnessMale = list()
validSetsThinnessMale = list()
for (i in 1:10){
  curSet = sansTestThinnessMale[[i]]
  validationFolds = createFolds(sansTestThinnessMale[[i]]$Thinness, k = 10)
  validSetsThinnessMale[[i]] = validationFolds
  UBThinnessMale[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEThinnessMale = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEThinnessMale[[i]] = list()
  for (j in 1:10){
    SMOTEThinnessMale[[i]][[j]] = SMOTE(X = as.data.frame(UBThinnessMale[[i]][[j]]),
                              target = UBThinnessMale[[i]][[j]]$Thinness,
                              K = 5,
                              dup_size = 8
                              )
     SMOTEThinnessMale[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBThinnessMale[[1]][[1]]$Thinness)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'ThinnessMale Training Set Class Distribution (Unbalanced)')
abline(h = 0)

barplot(prop.table(table(SMOTEThinnessMale[[1]][[1]]$data$Thinness)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'ThinnessMale Training Set Class Distribution (SMOTE)')
abline(h = 0)
################################################################################
table(UBThinnessMale[[1]][[1]]$Thinness)[[1]][[1]]
table(UBThinnessMale[[1]][[1]]$Thinness)[[2]][[1]]
table(UBThinnessMale[[1]][[1]]$Thinness)[[1]][[1]]/table(UBThinnessMale[[1]][[1]]$Thinness)[[2]][[1]]
table(SMOTEThinnessMale[[1]][[1]]$data$Thinness)[[1]][[1]]
table(SMOTEThinnessMale[[1]][[1]]$data$Thinness)[[2]][[1]]
table(SMOTEThinnessMale[[1]][[1]]$data$Thinness)[[1]][[1]]/table(SMOTEThinnessMale[[1]][[1]]$data$Thinness)[[2]][[1]]
```



```{r }
set.seed(13)
################################################################################
testFolds = createFolds(thinnessFemale$Thinness, k = 10) #Create k splits
testSetsThinnessFemale = list(thinnessFemale[testFolds$Fold01, ], thinnessFemale[testFolds$Fold02, ],
                        thinnessFemale[testFolds$Fold03, ], thinnessFemale[testFolds$Fold04, ],
                        thinnessFemale[testFolds$Fold05, ], thinnessFemale[testFolds$Fold06, ],
                        thinnessFemale[testFolds$Fold07, ], thinnessFemale[testFolds$Fold08, ],
                        thinnessFemale[testFolds$Fold09, ], thinnessFemale[testFolds$Fold10, ]
                        )
sansTestThinnessFemale = list(thinnessFemale[-testFolds$Fold01, ], thinnessFemale[-testFolds$Fold02, ],
                        thinnessFemale[-testFolds$Fold03, ], thinnessFemale[-testFolds$Fold04, ],
                        thinnessFemale[-testFolds$Fold05, ], thinnessFemale[-testFolds$Fold06, ],
                        thinnessFemale[-testFolds$Fold07, ], thinnessFemale[-testFolds$Fold08, ],
                        thinnessFemale[-testFolds$Fold09, ], thinnessFemale[-testFolds$Fold10, ]
                        )
UBThinnessFemale = list()
validSetsThinnessFemale = list()
for (i in 1:10){
  curSet = sansTestThinnessFemale[[i]]
  validationFolds = createFolds(sansTestThinnessFemale[[i]]$Thinness, k = 10)
  validSetsThinnessFemale[[i]] = validationFolds
  UBThinnessFemale[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEThinnessFemale = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEThinnessFemale[[i]] = list()
  for (j in 1:10){
    SMOTEThinnessFemale[[i]][[j]] = SMOTE(X = as.data.frame(UBThinnessFemale[[i]][[j]]),
                              target = UBThinnessFemale[[i]][[j]]$Thinness,
                              K = 5,
                              dup_size = 6
                              )
     SMOTEThinnessFemale[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBThinnessFemale[[1]][[1]]$Thinness)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'ThinnessFemale Training Set Class Distribution (Unbalanced)')
abline(h = 0)

barplot(prop.table(table(SMOTEThinnessFemale[[1]][[1]]$data$Thinness)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'ThinnessFemale Training Set Class Distribution (SMOTE)')
abline(h = 0)
################################################################################
table(UBThinnessFemale[[1]][[1]]$Thinness)[[1]][[1]]
table(UBThinnessFemale[[1]][[1]]$Thinness)[[2]][[1]]
table(UBThinnessFemale[[1]][[1]]$Thinness)[[1]][[1]]/table(UBThinnessFemale[[1]][[1]]$Thinness)[[2]][[1]]
table(SMOTEThinnessFemale[[1]][[1]]$data$Thinness)[[1]][[1]]
table(SMOTEThinnessFemale[[1]][[1]]$data$Thinness)[[2]][[1]]
table(SMOTEThinnessFemale[[1]][[1]]$data$Thinness)[[1]][[1]]/table(SMOTEThinnessFemale[[1]][[1]]$data$Thinness)[[2]][[1]]
```

```{r }
set.seed(13)
################################################################################
testFolds = createFolds(thinnessUrban$Thinness, k = 10) #Create k splits
testSetsThinnessUrban = list(thinnessUrban[testFolds$Fold01, ], thinnessUrban[testFolds$Fold02, ],
                        thinnessUrban[testFolds$Fold03, ], thinnessUrban[testFolds$Fold04, ],
                        thinnessUrban[testFolds$Fold05, ], thinnessUrban[testFolds$Fold06, ],
                        thinnessUrban[testFolds$Fold07, ], thinnessUrban[testFolds$Fold08, ],
                        thinnessUrban[testFolds$Fold09, ], thinnessUrban[testFolds$Fold10, ]
                        )
sansTestThinnessUrban = list(thinnessUrban[-testFolds$Fold01, ], thinnessUrban[-testFolds$Fold02, ],
                        thinnessUrban[-testFolds$Fold03, ], thinnessUrban[-testFolds$Fold04, ],
                        thinnessUrban[-testFolds$Fold05, ], thinnessUrban[-testFolds$Fold06, ],
                        thinnessUrban[-testFolds$Fold07, ], thinnessUrban[-testFolds$Fold08, ],
                        thinnessUrban[-testFolds$Fold09, ], thinnessUrban[-testFolds$Fold10, ]
                        )
UBThinnessUrban = list()
validSetsThinnessUrban = list()
for (i in 1:10){
  curSet = sansTestThinnessUrban[[i]]
  validationFolds = createFolds(sansTestThinnessUrban[[i]]$Thinness, k = 10)
  validSetsThinnessUrban[[i]] = validationFolds
  UBThinnessUrban[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEThinnessUrban = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEThinnessUrban[[i]] = list()
  for (j in 1:10){
    SMOTEThinnessUrban[[i]][[j]] = SMOTE(X = as.data.frame(UBThinnessUrban[[i]][[j]]),
                              target = UBThinnessUrban[[i]][[j]]$Thinness,
                              K = 5,
                              dup_size = 7
                              )
     SMOTEThinnessUrban[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBThinnessUrban[[1]][[1]]$Thinness)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'ThinnessUrban Training Set Class Distribution (Unbalanced)')
abline(h = 0)

barplot(prop.table(table(SMOTEThinnessUrban[[1]][[1]]$data$Thinness)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'ThinnessUrban Training Set Class Distribution (SMOTE)')
abline(h = 0)
################################################################################
table(UBThinnessUrban[[1]][[1]]$Thinness)[[1]][[1]]
table(UBThinnessUrban[[1]][[1]]$Thinness)[[2]][[1]]
table(UBThinnessUrban[[1]][[1]]$Thinness)[[1]][[1]]/table(UBThinnessUrban[[1]][[1]]$Thinness)[[2]][[1]]
table(SMOTEThinnessUrban[[1]][[1]]$data$Thinness)[[1]][[1]]
table(SMOTEThinnessUrban[[1]][[1]]$data$Thinness)[[2]][[1]]
table(SMOTEThinnessUrban[[1]][[1]]$data$Thinness)[[1]][[1]]/table(SMOTEThinnessUrban[[1]][[1]]$data$Thinness)[[2]][[1]]
```



```{r }
set.seed(13)
################################################################################
testFolds = createFolds(thinnessNotUrban$Thinness, k = 10) #Create k splits
testSetsThinnessNotUrban = list(thinnessNotUrban[testFolds$Fold01, ], thinnessNotUrban[testFolds$Fold02, ],
                        thinnessNotUrban[testFolds$Fold03, ], thinnessNotUrban[testFolds$Fold04, ],
                        thinnessNotUrban[testFolds$Fold05, ], thinnessNotUrban[testFolds$Fold06, ],
                        thinnessNotUrban[testFolds$Fold07, ], thinnessNotUrban[testFolds$Fold08, ],
                        thinnessNotUrban[testFolds$Fold09, ], thinnessNotUrban[testFolds$Fold10, ]
                        )
sansTestThinnessNotUrban = list(thinnessNotUrban[-testFolds$Fold01, ], thinnessNotUrban[-testFolds$Fold02, ],
                        thinnessNotUrban[-testFolds$Fold03, ], thinnessNotUrban[-testFolds$Fold04, ],
                        thinnessNotUrban[-testFolds$Fold05, ], thinnessNotUrban[-testFolds$Fold06, ],
                        thinnessNotUrban[-testFolds$Fold07, ], thinnessNotUrban[-testFolds$Fold08, ],
                        thinnessNotUrban[-testFolds$Fold09, ], thinnessNotUrban[-testFolds$Fold10, ]
                        )
UBThinnessNotUrban = list()
validSetsThinnessNotUrban = list()
for (i in 1:10){
  curSet = sansTestThinnessNotUrban[[i]]
  validationFolds = createFolds(sansTestThinnessNotUrban[[i]]$Thinness, k = 10)
  validSetsThinnessNotUrban[[i]] = validationFolds
  UBThinnessNotUrban[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEThinnessNotUrban = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEThinnessNotUrban[[i]] = list()
  for (j in 1:10){
    SMOTEThinnessNotUrban[[i]][[j]] = SMOTE(X = as.data.frame(UBThinnessNotUrban[[i]][[j]]),
                              target = UBThinnessNotUrban[[i]][[j]]$Thinness,
                              K = 2, #K had to be reduced; there weren't k = 5 minority class neighbors to extrapolate from, only 4
                              dup_size = 10
                              )
     SMOTEThinnessNotUrban[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBThinnessNotUrban[[1]][[1]]$Thinness)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'ThinnessNotUrban Training Set Class Distribution (Unbalanced)')
abline(h = 0)

barplot(prop.table(table(SMOTEThinnessNotUrban[[1]][[1]]$data$Thinness)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'ThinnessNotUrban Training Set Class Distribution (SMOTE)')
abline(h = 0)
################################################################################
table(UBThinnessNotUrban[[1]][[1]]$Thinness)[[1]][[1]]
table(UBThinnessNotUrban[[1]][[1]]$Thinness)[[2]][[1]]
table(UBThinnessNotUrban[[1]][[1]]$Thinness)[[1]][[1]]/table(UBThinnessNotUrban[[1]][[1]]$Thinness)[[2]][[1]]
table(SMOTEThinnessNotUrban[[1]][[1]]$data$Thinness)[[1]][[1]]
table(SMOTEThinnessNotUrban[[1]][[1]]$data$Thinness)[[2]][[1]]
table(SMOTEThinnessNotUrban[[1]][[1]]$data$Thinness)[[1]][[1]]/table(SMOTEThinnessNotUrban[[1]][[1]]$data$Thinness)[[2]][[1]]
```



```{r ThinnessYouth Train/Test Splits}
library(caret)
library(tidyverse)
library(smotefamily)

set.seed(13)
testFolds = createFolds(thinnessYouth$Thinness, k = 10) #Create k splits
testSetsThinnessYouth = list(thinnessYouth[testFolds$Fold01, ], thinnessYouth[testFolds$Fold02, ],
                        thinnessYouth[testFolds$Fold03, ], thinnessYouth[testFolds$Fold04, ],
                        thinnessYouth[testFolds$Fold05, ], thinnessYouth[testFolds$Fold06, ],
                        thinnessYouth[testFolds$Fold07, ], thinnessYouth[testFolds$Fold08, ],
                        thinnessYouth[testFolds$Fold09, ], thinnessYouth[testFolds$Fold10, ]
                        )
sansTestThinnessYouth = list(thinnessYouth[-testFolds$Fold01, ], thinnessYouth[-testFolds$Fold02, ],
                        thinnessYouth[-testFolds$Fold03, ], thinnessYouth[-testFolds$Fold04, ],
                        thinnessYouth[-testFolds$Fold05, ], thinnessYouth[-testFolds$Fold06, ],
                        thinnessYouth[-testFolds$Fold07, ], thinnessYouth[-testFolds$Fold08, ],
                        thinnessYouth[-testFolds$Fold09, ], thinnessYouth[-testFolds$Fold10, ]
                        )
UBThinnessYouth = list()
validSetsThinnessYouth = list()
for (i in 1:10){
  curSet = sansTestThinnessYouth[[i]]
  validationFolds = createFolds(sansTestThinnessYouth[[i]]$Thinness, k = 10)
  validSetsThinnessYouth[[i]] = validationFolds
  UBThinnessYouth[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEThinnessYouth = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEThinnessYouth[[i]] = list()
  for (j in 1:10){
    SMOTEThinnessYouth[[i]][[j]] = SMOTE(X = as.data.frame(UBThinnessYouth[[i]][[j]]),
                              target = UBThinnessYouth[[i]][[j]]$Thinness,
                              K = 5,
                              dup_size = 11
                              )
     SMOTEThinnessYouth[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBThinnessYouth[[1]][[1]]$Thinness)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Thinness",
        names = c("No", "Yes"),
        main = 'ThinnessYouth Training Set Class Distribution (Unbalanced)')
abline(h = 0)

barplot(prop.table(table(SMOTEThinnessYouth[[1]][[1]]$data$Thinness)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Thinness",
        names = c("No", "Yes"),
        main = 'ThinnessYouth Training Set Class Distribution (SMOTE)')
abline(h = 0)
################################################################################
table(UBThinnessYouth[[1]][[1]]$Thinness)[[1]][[1]]
table(UBThinnessYouth[[1]][[1]]$Thinness)[[2]][[1]]
table(UBThinnessYouth[[1]][[1]]$Thinness)[[1]][[1]]/table(UBThinnessYouth[[1]][[1]]$Thinness)[[2]][[1]]
table(SMOTEThinnessYouth[[1]][[1]]$data$Thinness)[[1]][[1]]
table(SMOTEThinnessYouth[[1]][[1]]$data$Thinness)[[2]][[1]]
table(SMOTEThinnessYouth[[1]][[1]]$data$Thinness)[[1]][[1]]/table(SMOTEThinnessYouth[[1]][[1]]$data$Thinness)[[2]][[1]]
```




```{r ThinnessAdolescent Train/Test Splits}
library(caret)
library(tidyverse)
library(smotefamily)

set.seed(13)
testFolds = createFolds(thinnessAdolescent$Thinness, k = 10) #Create k splits
testSetsThinnessAdolescent = list(thinnessAdolescent[testFolds$Fold01, ], thinnessAdolescent[testFolds$Fold02, ],
                        thinnessAdolescent[testFolds$Fold03, ], thinnessAdolescent[testFolds$Fold04, ],
                        thinnessAdolescent[testFolds$Fold05, ], thinnessAdolescent[testFolds$Fold06, ],
                        thinnessAdolescent[testFolds$Fold07, ], thinnessAdolescent[testFolds$Fold08, ],
                        thinnessAdolescent[testFolds$Fold09, ], thinnessAdolescent[testFolds$Fold10, ]
                        )
sansTestThinnessAdolescent = list(thinnessAdolescent[-testFolds$Fold01, ], thinnessAdolescent[-testFolds$Fold02, ],
                        thinnessAdolescent[-testFolds$Fold03, ], thinnessAdolescent[-testFolds$Fold04, ],
                        thinnessAdolescent[-testFolds$Fold05, ], thinnessAdolescent[-testFolds$Fold06, ],
                        thinnessAdolescent[-testFolds$Fold07, ], thinnessAdolescent[-testFolds$Fold08, ],
                        thinnessAdolescent[-testFolds$Fold09, ], thinnessAdolescent[-testFolds$Fold10, ]
                        )
UBThinnessAdolescent = list()
validSetsThinnessAdolescent = list()
for (i in 1:10){
  curSet = sansTestThinnessAdolescent[[i]]
  validationFolds = createFolds(sansTestThinnessAdolescent[[i]]$Thinness, k = 10)
  validSetsThinnessAdolescent[[i]] = validationFolds
  UBThinnessAdolescent[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEThinnessAdolescent = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEThinnessAdolescent[[i]] = list()
  for (j in 1:10){
    SMOTEThinnessAdolescent[[i]][[j]] = SMOTE(X = as.data.frame(UBThinnessAdolescent[[i]][[j]]),
                              target = UBThinnessAdolescent[[i]][[j]]$Thinness,
                              K = 5,
                              dup_size = 6
                              )
     SMOTEThinnessAdolescent[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBThinnessAdolescent[[1]][[1]]$Thinness)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Thinness",
        names = c("No", "Yes"),
        main = 'ThinnessAdolescent Training Set Class Distribution (Unbalanced)')
abline(h = 0)

barplot(prop.table(table(SMOTEThinnessAdolescent[[1]][[1]]$data$Thinness)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Thinness",
        names = c("No", "Yes"),
        main = 'ThinnessAdolescent Training Set Class Distribution (SMOTE)')
abline(h = 0)
################################################################################
table(UBThinnessAdolescent[[1]][[1]]$Thinness)[[1]][[1]]
table(UBThinnessAdolescent[[1]][[1]]$Thinness)[[2]][[1]]
table(UBThinnessAdolescent[[1]][[1]]$Thinness)[[1]][[1]]/table(UBThinnessAdolescent[[1]][[1]]$Thinness)[[2]][[1]]
table(SMOTEThinnessAdolescent[[1]][[1]]$data$Thinness)[[1]][[1]]
table(SMOTEThinnessAdolescent[[1]][[1]]$data$Thinness)[[2]][[1]]
table(SMOTEThinnessAdolescent[[1]][[1]]$data$Thinness)[[1]][[1]]/table(SMOTEThinnessAdolescent[[1]][[1]]$data$Thinness)[[2]][[1]]
```



```{r Wasting Train/Test Splits}
library(caret)
library(tidyverse)
library(smotefamily)

set.seed(13)
testFolds = createFolds(wasting$Wasting, k = 10) #Create k splits
testSetsWasting = list(wasting[testFolds$Fold01, ], wasting[testFolds$Fold02, ],
                        wasting[testFolds$Fold03, ], wasting[testFolds$Fold04, ],
                        wasting[testFolds$Fold05, ], wasting[testFolds$Fold06, ],
                        wasting[testFolds$Fold07, ], wasting[testFolds$Fold08, ],
                        wasting[testFolds$Fold09, ], wasting[testFolds$Fold10, ]
                        )
sansTestWasting = list(wasting[-testFolds$Fold01, ], wasting[-testFolds$Fold02, ],
                        wasting[-testFolds$Fold03, ], wasting[-testFolds$Fold04, ],
                        wasting[-testFolds$Fold05, ], wasting[-testFolds$Fold06, ],
                        wasting[-testFolds$Fold07, ], wasting[-testFolds$Fold08, ],
                        wasting[-testFolds$Fold09, ], wasting[-testFolds$Fold10, ]
                        )
UBWasting = list()
validSetsWasting = list()
for (i in 1:10){
  curSet = sansTestWasting[[i]]
  validationFolds = createFolds(sansTestWasting[[i]]$Wasting, k = 10)
  validSetsWasting[[i]] = validationFolds
  UBWasting[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEWasting = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEWasting[[i]] = list()
  for (j in 1:10){
    SMOTEWasting[[i]][[j]] = SMOTE(X = as.data.frame(UBWasting[[i]][[j]]),
                              target = UBWasting[[i]][[j]]$Wasting,
                              K = 5,
                              dup_size = 3
                              )
     SMOTEWasting[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBWasting[[1]][[1]]$Wasting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Wasting",
        names = c("No", "Yes"),
        main = 'Wasting Training Set Class Distribution (Unbalanced)')
abline(h = 0)

barplot(prop.table(table(SMOTEWasting[[1]][[1]]$data$Wasting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'Wasting Training Set Class Distribution (SMOTE)')
abline(h = 0)
################################################################################
table(UBWasting[[1]][[1]]$Wasting)[[1]][[1]]
table(UBWasting[[1]][[1]]$Wasting)[[2]][[1]]
table(UBWasting[[1]][[1]]$Wasting)[[1]][[1]]/table(UBWasting[[1]][[1]]$Wasting)[[2]][[1]]
table(SMOTEWasting[[1]][[1]]$data$Wasting)[[1]][[1]]
table(SMOTEWasting[[1]][[1]]$data$Wasting)[[2]][[1]]
table(SMOTEWasting[[1]][[1]]$data$Wasting)[[1]][[1]]/table(SMOTEWasting[[1]][[1]]$data$Wasting)[[2]][[1]]
```



```{r }
set.seed(13)
################################################################################
testFolds = createFolds(wastingMale$Wasting, k = 10) #Create k splits
testSetsWastingMale = list(wastingMale[testFolds$Fold01, ], wastingMale[testFolds$Fold02, ],
                        wastingMale[testFolds$Fold03, ], wastingMale[testFolds$Fold04, ],
                        wastingMale[testFolds$Fold05, ], wastingMale[testFolds$Fold06, ],
                        wastingMale[testFolds$Fold07, ], wastingMale[testFolds$Fold08, ],
                        wastingMale[testFolds$Fold09, ], wastingMale[testFolds$Fold10, ]
                        )
sansTestWastingMale = list(wastingMale[-testFolds$Fold01, ], wastingMale[-testFolds$Fold02, ],
                        wastingMale[-testFolds$Fold03, ], wastingMale[-testFolds$Fold04, ],
                        wastingMale[-testFolds$Fold05, ], wastingMale[-testFolds$Fold06, ],
                        wastingMale[-testFolds$Fold07, ], wastingMale[-testFolds$Fold08, ],
                        wastingMale[-testFolds$Fold09, ], wastingMale[-testFolds$Fold10, ]
                        )
UBWastingMale = list()
validSetsWastingMale = list()
for (i in 1:10){
  curSet = sansTestWastingMale[[i]]
  validationFolds = createFolds(sansTestWastingMale[[i]]$Wasting, k = 10)
  validSetsWastingMale[[i]] = validationFolds
  UBWastingMale[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEWastingMale = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEWastingMale[[i]] = list()
  for (j in 1:10){
    SMOTEWastingMale[[i]][[j]] = SMOTE(X = as.data.frame(UBWastingMale[[i]][[j]]),
                              target = UBWastingMale[[i]][[j]]$Wasting,
                              K = 5,
                              dup_size = 2
                              )
     SMOTEWastingMale[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBWastingMale[[1]][[1]]$Wasting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'UBWastingMale Training Set Class Distribution')
abline(h = 0)

barplot(prop.table(table(SMOTEWastingMale[[1]][[1]]$data$Wasting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'SMOTEWastingMale Training Set Class Distribution')
abline(h = 0)
################################################################################
table(UBWastingMale[[1]][[1]]$Wasting)[[1]][[1]]
table(UBWastingMale[[1]][[1]]$Wasting)[[2]][[1]]
table(UBWastingMale[[1]][[1]]$Wasting)[[1]][[1]]/table(UBWastingMale[[1]][[1]]$Wasting)[[2]][[1]]
table(SMOTEWastingMale[[1]][[1]]$data$Wasting)[[1]][[1]]
table(SMOTEWastingMale[[1]][[1]]$data$Wasting)[[2]][[1]]
table(SMOTEWastingMale[[1]][[1]]$data$Wasting)[[1]][[1]]/table(SMOTEWastingMale[[1]][[1]]$data$Wasting)[[2]][[1]]
```



```{r }
set.seed(13)
################################################################################
testFolds = createFolds(wastingFemale$Wasting, k = 10) #Create k splits
testSetsWastingFemale = list(wastingFemale[testFolds$Fold01, ], wastingFemale[testFolds$Fold02, ],
                        wastingFemale[testFolds$Fold03, ], wastingFemale[testFolds$Fold04, ],
                        wastingFemale[testFolds$Fold05, ], wastingFemale[testFolds$Fold06, ],
                        wastingFemale[testFolds$Fold07, ], wastingFemale[testFolds$Fold08, ],
                        wastingFemale[testFolds$Fold09, ], wastingFemale[testFolds$Fold10, ]
                        )
sansTestWastingFemale = list(wastingFemale[-testFolds$Fold01, ], wastingFemale[-testFolds$Fold02, ],
                        wastingFemale[-testFolds$Fold03, ], wastingFemale[-testFolds$Fold04, ],
                        wastingFemale[-testFolds$Fold05, ], wastingFemale[-testFolds$Fold06, ],
                        wastingFemale[-testFolds$Fold07, ], wastingFemale[-testFolds$Fold08, ],
                        wastingFemale[-testFolds$Fold09, ], wastingFemale[-testFolds$Fold10, ]
                        )
UBWastingFemale = list()
validSetsWastingFemale = list()
for (i in 1:10){
  curSet = sansTestWastingFemale[[i]]
  validationFolds = createFolds(sansTestWastingFemale[[i]]$Wasting, k = 10)
  validSetsWastingFemale[[i]] = validationFolds
  UBWastingFemale[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEWastingFemale = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEWastingFemale[[i]] = list()
  for (j in 1:10){
    SMOTEWastingFemale[[i]][[j]] = SMOTE(X = as.data.frame(UBWastingFemale[[i]][[j]]),
                              target = UBWastingFemale[[i]][[j]]$Wasting,
                              K = 5,
                              dup_size = 3
                              )
     SMOTEWastingFemale[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBWastingFemale[[1]][[1]]$Wasting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'UBWastingFemale Training Set Class Distribution')
abline(h = 0)

barplot(prop.table(table(SMOTEWastingFemale[[1]][[1]]$data$Wasting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'SMOTEWastingFemale Training Set Class Distribution')
abline(h = 0)
################################################################################
table(UBWastingFemale[[1]][[1]]$Wasting)[[1]][[1]]
table(UBWastingFemale[[1]][[1]]$Wasting)[[2]][[1]]
table(UBWastingFemale[[1]][[1]]$Wasting)[[1]][[1]]/table(UBWastingFemale[[1]][[1]]$Wasting)[[2]][[1]]
table(SMOTEWastingFemale[[1]][[1]]$data$Wasting)[[1]][[1]]
table(SMOTEWastingFemale[[1]][[1]]$data$Wasting)[[2]][[1]]
table(SMOTEWastingFemale[[1]][[1]]$data$Wasting)[[1]][[1]]/table(SMOTEWastingFemale[[1]][[1]]$data$Wasting)[[2]][[1]]
```



```{r }
set.seed(13)
################################################################################
testFolds = createFolds(wastingUrban$Wasting, k = 10) #Create k splits
testSetsWastingUrban = list(wastingUrban[testFolds$Fold01, ], wastingUrban[testFolds$Fold02, ],
                        wastingUrban[testFolds$Fold03, ], wastingUrban[testFolds$Fold04, ],
                        wastingUrban[testFolds$Fold05, ], wastingUrban[testFolds$Fold06, ],
                        wastingUrban[testFolds$Fold07, ], wastingUrban[testFolds$Fold08, ],
                        wastingUrban[testFolds$Fold09, ], wastingUrban[testFolds$Fold10, ]
                        )
sansTestWastingUrban = list(wastingUrban[-testFolds$Fold01, ], wastingUrban[-testFolds$Fold02, ],
                        wastingUrban[-testFolds$Fold03, ], wastingUrban[-testFolds$Fold04, ],
                        wastingUrban[-testFolds$Fold05, ], wastingUrban[-testFolds$Fold06, ],
                        wastingUrban[-testFolds$Fold07, ], wastingUrban[-testFolds$Fold08, ],
                        wastingUrban[-testFolds$Fold09, ], wastingUrban[-testFolds$Fold10, ]
                        )
UBWastingUrban = list()
validSetsWastingUrban = list()
for (i in 1:10){
  curSet = sansTestWastingUrban[[i]]
  validationFolds = createFolds(sansTestWastingUrban[[i]]$Wasting, k = 10)
  validSetsWastingUrban[[i]] = validationFolds
  UBWastingUrban[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEWastingUrban = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEWastingUrban[[i]] = list()
  for (j in 1:10){
    SMOTEWastingUrban[[i]][[j]] = SMOTE(X = as.data.frame(UBWastingUrban[[i]][[j]]),
                              target = UBWastingUrban[[i]][[j]]$Wasting,
                              K = 5,
                              dup_size = 2
                              )
     SMOTEWastingUrban[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBWastingUrban[[1]][[1]]$Wasting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'UBWastingUrban Training Set Class Distribution')
abline(h = 0)

barplot(prop.table(table(SMOTEWastingUrban[[1]][[1]]$data$Wasting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'SMOTEWastingUrban Training Set Class Distribution')
abline(h = 0)
################################################################################
table(UBWastingUrban[[1]][[1]]$Wasting)[[1]][[1]]
table(UBWastingUrban[[1]][[1]]$Wasting)[[2]][[1]]
table(UBWastingUrban[[1]][[1]]$Wasting)[[1]][[1]]/table(UBWastingUrban[[1]][[1]]$Wasting)[[2]][[1]]
table(SMOTEWastingUrban[[1]][[1]]$data$Wasting)[[1]][[1]]
table(SMOTEWastingUrban[[1]][[1]]$data$Wasting)[[2]][[1]]
table(SMOTEWastingUrban[[1]][[1]]$data$Wasting)[[1]][[1]]/table(SMOTEWastingUrban[[1]][[1]]$data$Wasting)[[2]][[1]]
```



```{r }
set.seed(13)
################################################################################
testFolds = createFolds(wastingNotUrban$Wasting, k = 10) #Create k splits
testSetsWastingNotUrban = list(wastingNotUrban[testFolds$Fold01, ], wastingNotUrban[testFolds$Fold02, ],
                        wastingNotUrban[testFolds$Fold03, ], wastingNotUrban[testFolds$Fold04, ],
                        wastingNotUrban[testFolds$Fold05, ], wastingNotUrban[testFolds$Fold06, ],
                        wastingNotUrban[testFolds$Fold07, ], wastingNotUrban[testFolds$Fold08, ],
                        wastingNotUrban[testFolds$Fold09, ], wastingNotUrban[testFolds$Fold10, ]
                        )
sansTestWastingNotUrban = list(wastingNotUrban[-testFolds$Fold01, ], wastingNotUrban[-testFolds$Fold02, ],
                        wastingNotUrban[-testFolds$Fold03, ], wastingNotUrban[-testFolds$Fold04, ],
                        wastingNotUrban[-testFolds$Fold05, ], wastingNotUrban[-testFolds$Fold06, ],
                        wastingNotUrban[-testFolds$Fold07, ], wastingNotUrban[-testFolds$Fold08, ],
                        wastingNotUrban[-testFolds$Fold09, ], wastingNotUrban[-testFolds$Fold10, ]
                        )
UBWastingNotUrban = list()
validSetsWastingNotUrban = list()
for (i in 1:10){
  curSet = sansTestWastingNotUrban[[i]]
  validationFolds = createFolds(sansTestWastingNotUrban[[i]]$Wasting, k = 10)
  validSetsWastingNotUrban[[i]] = validationFolds
  UBWastingNotUrban[[i]] = list(curSet[-validationFolds$Fold01, ], #Remove subsets from current set
                         curSet[-validationFolds$Fold02, ],
                         curSet[-validationFolds$Fold03, ],
                         curSet[-validationFolds$Fold04, ],
                         curSet[-validationFolds$Fold05, ],
                         curSet[-validationFolds$Fold06, ],
                         curSet[-validationFolds$Fold07, ],
                         curSet[-validationFolds$Fold08, ],
                         curSet[-validationFolds$Fold09, ],
                         curSet[-validationFolds$Fold10, ]
                         )
}
SMOTEWastingNotUrban = list()
for (i in 1:10){ #Use SMOTE to create balanced versions of each of the training sets
  SMOTEWastingNotUrban[[i]] = list()
  for (j in 1:10){
    SMOTEWastingNotUrban[[i]][[j]] = SMOTE(X = as.data.frame(UBWastingNotUrban[[i]][[j]]),
                              target = UBWastingNotUrban[[i]][[j]]$Wasting,
                              K = 4,
                              dup_size = 2
                              )
     SMOTEWastingNotUrban[[i]][[j]]$data$class = NULL #Extra random variable, breaks modelling
  }
}
################################################################################
barplot(prop.table(table(UBWastingNotUrban[[1]][[1]]$Wasting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'UBWastingNotUrban Training Set Class Distribution')
abline(h = 0)

barplot(prop.table(table(SMOTEWastingNotUrban[[1]][[1]]$data$Wasting)),
        col = c("white", "darkgrey"),
        ylim = c(0, 1),
        xlim = c(0, 3),
        ylab = "Prevalence (%)",
        xlab = "Stunting",
        names = c("No", "Yes"),
        main = 'SMOTEWastingNotUrban Training Set Class Distribution')
abline(h = 0)
################################################################################
table(UBWastingNotUrban[[1]][[1]]$Wasting)[[1]][[1]]
table(UBWastingNotUrban[[1]][[1]]$Wasting)[[2]][[1]]
table(UBWastingNotUrban[[1]][[1]]$Wasting)[[1]][[1]]/table(UBWastingNotUrban[[1]][[1]]$Wasting)[[2]][[1]]
table(SMOTEWastingNotUrban[[1]][[1]]$data$Wasting)[[1]][[1]]
table(SMOTEWastingNotUrban[[1]][[1]]$data$Wasting)[[2]][[1]]
table(SMOTEWastingNotUrban[[1]][[1]]$data$Wasting)[[1]][[1]]/table(SMOTEWastingNotUrban[[1]][[1]]$data$Wasting)[[2]][[1]]
```



#####
# FEATURE SELECTION: Selects important model features to reduce noise and help 
# prevent overfitting. All feature selection methods should be run on SMOTE-
# balanced datasets.
#####
# ```{r ReliefF Computations}
# #This one takes ~5 hours to run. Have fun waiting.
# library(FSelectorRcpp)
# 
# ################################################################################
# FS_RLF_Stunting = list()
# for (i in 1:10){
#   FS_RLF_Stunting[[i]] = list()
#   for (j in 1:10){
#     relF = relief(Stunting~.,
#                 as.data.frame(UBStunting[[i]][[j]]),
#                 neighboursCount = 5
#                 )
#     FS_RLF_Stunting[[i]][[j]] = relF[order(relF$importance), ]
#   }
# }
# ################################################################################
# FS_RLF_StuntingMale = list()
# for (i in 1:10){
#   FS_RLF_StuntingMale[[i]] = list()
#   for (j in 1:10){
#     relF = relief(Stunting~.,
#                 as.data.frame(UBStuntingMale[[i]][[j]]),
#                 neighboursCount = 5
#                 )
#     FS_RLF_StuntingMale[[i]][[j]] = relF[order(relF$importance), ]
#   }
# }
# ################################################################################
# FS_RLF_StuntingFemale = list()
# for (i in 1:10){
#   FS_RLF_StuntingFemale[[i]] = list()
#   for (j in 1:10){
#     relF = relief(Stunting~.,
#                 as.data.frame(SMOTEStuntingFemale[[i]][[j]]$data),
#                 neighboursCount = 5
#                 )
#     FS_RLF_StuntingFemale[[i]][[j]] = relF[order(relF$importance), ]
#   }
# }
# ################################################################################
# FS_RLF_StuntingUrban = list()
# for (i in 1:10){
#   FS_RLF_StuntingUrban[[i]] = list()
#   for (j in 1:10){
#     relF = relief(Stunting~.,
#                 as.data.frame(UBStunting[[i]][[j]]),
#                 neighboursCount = 5
#                 )
#     FS_RLF_StuntingUrban[[i]][[j]] = relF[order(relF$importance), ]
#   }
# }
# ################################################################################
# FS_RLF_StuntingNotUrban = list()
# for (i in 1:10){
#   FS_RLF_StuntingNotUrban[[i]] = list()
#   for (j in 1:10){
#     relF = relief(Stunting~.,
#                 as.data.frame(UBStunting[[i]][[j]]),
#                 neighboursCount = 5
#                 )
#     FS_RLF_StuntingNotUrban[[i]][[j]] = relF[order(relF$importance), ]
#   }
# }
# ################################################################################
# FS_RLF_Thinness = list()
# for (i in 1:10){
#   FS_RLF_Thinness[[i]] = list()
#   for (j in 1:10){
#     relF = relief(Thinness~.,
#                 as.data.frame(SMOTEThinness[[i]][[j]]$data),
#                 neighboursCount = 5
#                 )
#     FS_RLF_Thinness[[i]][[j]] = relF[order(relF$importance), ]
#   }
# }
# ################################################################################
# FS_RLF_ThinnessMale = list()
# for (i in 1:10){
#   FS_RLF_ThinnessMale[[i]] = list()
#   for (j in 1:10){
#     relF = relief(Thinness~.,
#                 as.data.frame(SMOTEThinnessMale[[i]][[j]]$data),
#                 neighboursCount = 5
#                 )
#     FS_RLF_ThinnessMale[[i]][[j]] = relF[order(relF$importance), ]
#   }
# }
# ################################################################################
# FS_RLF_ThinnessFemale = list()
# for (i in 1:10){
#   FS_RLF_ThinnessFemale[[i]] = list()
#   for (j in 1:10){
#     relF = relief(Thinness~.,
#                 as.data.frame(SMOTEThinnessFemale[[i]][[j]]$data),
#                 neighboursCount = 5
#                 )
#     FS_RLF_ThinnessFemale[[i]][[j]] = relF[order(relF$importance), ]
#   }
# }
# ################################################################################
# FS_RLF_ThinnessUrban = list()
# for (i in 1:10){
#   FS_RLF_ThinnessUrban[[i]] = list()
#   for (j in 1:10){
#     relF = relief(Thinness~.,
#                 as.data.frame(SMOTEThinnessUrban[[i]][[j]]$data),
#                 neighboursCount = 5
#                 )
#     FS_RLF_ThinnessUrban[[i]][[j]] = relF[order(relF$importance), ]
#   }
# }
# ################################################################################
# FS_RLF_ThinnessNotUrban = list()
# for (i in 1:10){
#   FS_RLF_ThinnessNotUrban[[i]] = list()
#   for (j in 1:10){
#     relF = relief(Thinness~.,
#                 as.data.frame(SMOTEThinnessNotUrban[[i]][[j]]$data),
#                 neighboursCount = 5
#                 )
#     FS_RLF_ThinnessNotUrban[[i]][[j]] = relF[order(relF$importance), ]
#   }
# }
# ################################################################################
# FS_RLF_Wasting = list()
# for (i in 1:10){
#   FS_RLF_Wasting[[i]] = list()
#   for (j in 1:10){
#     relF = relief(Wasting~.,
#                 as.data.frame(SMOTEWasting[[i]][[j]]$data),
#                 neighboursCount = 5
#                 )
#     FS_RLF_Wasting[[i]][[j]] = relF[order(relF$importance), ]
#   }
# }
# ################################################################################
# FS_RLF_WastingMale = list()
# for (i in 1:10){
#   FS_RLF_WastingMale[[i]] = list()
#   for (j in 1:10){
#     relF = relief(Wasting~.,
#                 as.data.frame(SMOTEWastingMale[[i]][[j]]$data),
#                 neighboursCount = 5
#                 )
#     FS_RLF_WastingMale[[i]][[j]] = relF[order(relF$importance), ]
#   }
# }
# ################################################################################
# FS_RLF_WastingFemale = list()
# for (i in 1:10){
#   FS_RLF_WastingFemale[[i]] = list()
#   for (j in 1:10){
#     relF = relief(Wasting~.,
#                 as.data.frame(SMOTEWastingFemale[[i]][[j]]$data),
#                 neighboursCount = 5
#                 )
#     FS_RLF_WastingFemale[[i]][[j]] = relF[order(relF$importance), ]
#   }
# }
# ################################################################################
# FS_RLF_WastingUrban = list()
# for (i in 1:10){
#   FS_RLF_WastingUrban[[i]] = list()
#   for (j in 1:10){
#     relF = relief(Wasting~.,
#                 as.data.frame(SMOTEWastingUrban[[i]][[j]]$data),
#                 neighboursCount = 5
#                 )
#     FS_RLF_WastingUrban[[i]][[j]] = relF[order(relF$importance), ]
#   }
# }
# ################################################################################
# FS_RLF_WastingNotUrban = list()
# for (i in 1:10){
#   FS_RLF_WastingNotUrban[[i]] = list()
#   for (j in 1:10){
#     relF = relief(Wasting~.,
#                 as.data.frame(SMOTEWastingNotUrban[[i]][[j]]$data),
#                 neighboursCount = 5
#                 )
#     FS_RLF_WastingNotUrban[[i]][[j]] = relF[order(relF$importance), ]
#   }
# }
# ################################################################################
# ```
# 
# 
# 
# ```{r ReliefF Results}
# #Separated from computations so I don't have to wait an hour and a half to see if my new code can parse the results correctly
# ################################################################################
# FS_RLF = data.frame(Stunting = double(),
#                      StuntingMale = double(),
#                      StuntingFemale = double(),
#                      StuntingUrban = double(),
#                      StuntingNotUrban = double(),
#                      
#                      Thinness = double(),
#                      ThinnessMale = double(),
#                      ThinnessFemale = double(),
#                      ThinnessUrban = double(),
#                      ThinnessNotUrban = double(),
#                      
#                      Wasting = double(),
#                      WastingMale = double(),
#                      WastingFemale = double(), 
#                      WastingUrban = double(), 
#                      WastingNotUrban = double()
#                      )
# for (i in 1:40){
#  FS_RLF[i,] = 0
# }
# row.names(FS_RLF) = names(stunting)[1:40]
# ################################################################################
# COPY = FS_RLF_Stunting
# for (factor in names(stunting)[1:40]){
#   sum = 0
#   for (i in 1:10){
#     for (j in 1:10){
#       index = which(COPY[[i]][[j]]$attributes == factor)
#       if (is.na(COPY[[i]][[j]]$importance[[index]])){
#         next
#       }else{
#         sum = sum + COPY[[i]][[j]]$importance[[index]]
#       }
#     }
#   }
#   AVG_FS_RLF[[factor, 1]] = sum/100
# }
# ################################################################################
# COPY = FS_RLF_Thinness
# for (factor in names(thinness)[1:54]){
#   sum = 0
#   for (i in 1:10){
#     for (j in 1:10){
#       index = which(COPY[[i]][[j]]$attributes == factor)
#       if (is.na(COPY[[i]][[j]]$importance[[index]])){
#         next
#       }else{
#         sum = sum + COPY[[i]][[j]]$importance[[index]]
#       }
#     }
#   }
#   AVG_FS_RLF[[factor, 2]] = sum/100
# }
# ################################################################################
# COPY = FS_RLF_StuntingYoung
# for (factor in names(StuntingYoung)[1:54]){
#   sum = 0
#   for (i in 1:10){
#     for (j in 1:10){
#       index = which(COPY[[i]][[j]]$attributes == factor)
#       if (is.na(COPY[[i]][[j]]$importance[[index]])){
#         next
#       }else{
#         sum = sum + COPY[[i]][[j]]$importance[[index]]
#       }
#     }
#   }
#   AVG_FS_RLF[[factor, 3]] = sum/100
# }
# ################################################################################
# COPY = FS_RLF_ThinnessYoung
# for (factor in names(thinnessYoung)[1:54]){
#   sum = 0
#   for (i in 1:10){
#     for (j in 1:10){
#       index = which(COPY[[i]][[j]]$attributes == factor)
#       if (is.na(COPY[[i]][[j]]$importance[[index]])){
#         next
#       }else{
#         sum = sum + COPY[[i]][[j]]$importance[[index]]
#       }
#     }
#   }
#   AVG_FS_RLF[[factor, 4]] = sum/100
# }
# ################################################################################
# COPY = FS_RLF_WastingYoung
# for (factor in names(WastingYoung)[1:54]){
#   sum = 0
#   for (i in 1:10){
#     for (j in 1:10){
#       index = which(COPY[[i]][[j]]$attributes == factor)
#       if (is.na(COPY[[i]][[j]]$importance[[index]])){
#         next
#       }else{
#         sum = sum + COPY[[i]][[j]]$importance[[index]]
#       }
#     }
#   }
#   AVG_FS_RLF[[factor, 5]] = sum/100
# }
# write.csv(AVG_FS_RLF, "FS_RLF_Avg.csv")
# ################################################################################
# ```



```{r InfoGain}
#This one is pretty quick.
library(FSelectorRcpp)

FS_IG = data.frame(Stunting = double(),
                     StuntingMale = double(),
                     StuntingFemale = double(),
                     StuntingUrban = double(),
                     StuntingNotUrban = double(),
                     StuntingYouth = double(),
                     StuntingAdolescent = double(),
                     
                     Thinness = double(),
                     ThinnessMale = double(),
                     ThinnessFemale = double(),
                     ThinnessUrban = double(),
                     ThinnessNotUrban = double(),
                     ThinnessYouth = double(),
                     ThinnessAdolescent = double(),
                     
                     Wasting = double(),
                     WastingMale = double(),
                     WastingFemale = double(), 
                     WastingUrban = double(), 
                     WastingNotUrban = double()
                     )
for (i in 1:40){
 FS_IG[i,] = 0
}
row.names(FS_IG) = names(stunting)[1:40]
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Stunting~.,
                              data = as.data.frame(UBStunting[[i]][[j]]),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),] #Order by importance
   for (k in 1:10){ #Look at top 10 most important features
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 1]] = FS_IG[[factor, 1]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Stunting~.,
                              data = as.data.frame(UBStuntingMale[[i]][[j]]),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),]
   for (k in 1:10){
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 2]] = FS_IG[[factor, 2]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Stunting~.,
                              data = as.data.frame(SMOTEStuntingFemale[[i]][[j]]$data),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),]
   for (k in 1:10){
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 3]] = FS_IG[[factor, 3]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Stunting~.,
                              data = as.data.frame(UBStuntingUrban[[i]][[j]]),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),]
   for (k in 1:10){
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 4]] = FS_IG[[factor, 4]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Stunting~.,
                              data = as.data.frame(UBStuntingNotUrban[[i]][[j]]),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),]
   for (k in 1:10){
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 5]] = FS_IG[[factor, 5]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Stunting~.,
                              data = as.data.frame(UBStuntingYouth[[i]][[j]]),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),] #Order by importance
   for (k in 1:10){ #Look at top 20 most important features
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 6]] = FS_IG[[factor, 6]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Stunting~.,
                              data = as.data.frame(UBStuntingAdolescent[[i]][[j]]),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),] #Order by importance
   for (k in 1:10){ #Look at top 20 most important features
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 7]] = FS_IG[[factor, 7]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Thinness~.,
                              data = as.data.frame(SMOTEThinness[[i]][[j]]$data),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),]
   for (k in 1:10){
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 8]] = FS_IG[[factor, 8]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Thinness~.,
                              data = as.data.frame(SMOTEThinnessMale[[i]][[j]]$data),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),]
   for (k in 1:10){
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 9]] = FS_IG[[factor, 9]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Thinness~.,
                              data = as.data.frame(SMOTEThinnessFemale[[i]][[j]]$data),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),]
   for (k in 1:10){
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 10]] = FS_IG[[factor, 10]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Thinness~.,
                              data = as.data.frame(SMOTEThinnessUrban[[i]][[j]]$data),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),]
   for (k in 1:10){
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 11]] = FS_IG[[factor, 11]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Thinness~.,
                              data = as.data.frame(SMOTEThinnessNotUrban[[i]][[j]]$data),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),]
   for (k in 1:10){
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 12]] = FS_IG[[factor, 12]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Thinness~.,
                              data = as.data.frame(SMOTEThinnessYouth[[i]][[j]]$data),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),]
   for (k in 1:10){
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 13]] = FS_IG[[factor, 13]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Thinness~.,
                              data = as.data.frame(SMOTEThinnessAdolescent[[i]][[j]]$data),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),]
   for (k in 1:10){
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 14]] = FS_IG[[factor, 14]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Wasting~.,
                              data = as.data.frame(SMOTEWasting[[i]][[j]]$data),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),]
   for (k in 1:10){
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 15]] = FS_IG[[factor, 15]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Wasting~.,
                              data = as.data.frame(SMOTEWastingMale[[i]][[j]]$data),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),]
   for (k in 1:10){
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 16]] = FS_IG[[factor, 16]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Wasting~.,
                              data = as.data.frame(SMOTEWastingFemale[[i]][[j]]$data),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),]
   for (k in 1:10){
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 17]] = FS_IG[[factor, 17]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Wasting~.,
                              data = as.data.frame(SMOTEWastingUrban[[i]][[j]]$data),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),]
   for (k in 1:10){
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 18]] = FS_IG[[factor, 18]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    infogain = information_gain(formula = Wasting~.,
                              data = as.data.frame(SMOTEWastingNotUrban[[i]][[j]]$data),
                              type = 'infogain',
                              equal = TRUE
                              )
    infogain = infogain[order(infogain$importance, decreasing = TRUE),]
    for (k in 1:10){
      factor = infogain[[k, 1]]
      if (infogain[[k, 2]] > 0){
        FS_IG[[factor, 19]] = FS_IG[[factor, 19]] + 1
      }
    }
  }
}
################################################################################
write.csv(FS_IG, "FS_IG_10.csv")
```



```{r mRMR}
library(mRMRe)
#This one is pretty quick.

FS_MRMR = data.frame(Stunting = double(),
                     StuntingMale = double(),
                     StuntingFemale = double(),
                     StuntingUrban = double(),
                     StuntingNotUrban = double(),
                     StuntingYouth = double(),
                     StuntingAdolescent = double(),
                     
                     Thinness = double(),
                     ThinnessMale = double(),
                     ThinnessFemale = double(),
                     ThinnessUrban = double(),
                     ThinnessNotUrban = double(),
                     ThinnessYouth = double(),
                     ThinnessAdolescent = double(),
                     
                     Wasting = double(),
                     WastingMale = double(),
                     WastingFemale = double(), 
                     WastingUrban = double(), 
                     WastingNotUrban = double()
                     )
for (i in 1:40){
 FS_MRMR[i,] = 0
}
row.names(FS_MRMR) = names(stunting)[1:40]
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = UBStunting[[i]][[j]])
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 1]] = FS_MRMR[[factor, 1]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = UBStuntingMale[[i]][[j]])
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 2]] = FS_MRMR[[factor, 2]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = SMOTEStuntingFemale[[i]][[j]]$data)
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 3]] = FS_MRMR[[factor, 3]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = UBStuntingUrban[[i]][[j]])
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 4]] = FS_MRMR[[factor, 4]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = UBStuntingNotUrban[[i]][[j]])
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 5]] = FS_MRMR[[factor, 5]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = UBStuntingYouth[[i]][[j]])
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 6]] = FS_MRMR[[factor, 6]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = UBStunting[[i]][[j]])
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 7]] = FS_MRMR[[factor, 7]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = SMOTEThinness[[i]][[j]]$data)
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 8]] = FS_MRMR[[factor, 8]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = SMOTEThinnessMale[[i]][[j]]$data)
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 9]] = FS_MRMR[[factor, 9]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = SMOTEThinnessFemale[[i]][[j]]$data)
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 10]] = FS_MRMR[[factor, 10]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = SMOTEThinnessUrban[[i]][[j]]$data)
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 11]] = FS_MRMR[[factor, 11]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = SMOTEThinnessNotUrban[[i]][[j]]$data)
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 12]] = FS_MRMR[[factor, 12]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = SMOTEThinnessYouth[[i]][[j]]$data)
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 13]] = FS_MRMR[[factor, 13]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = SMOTEThinnessAdolescent[[i]][[j]]$data)
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 14]] = FS_MRMR[[factor, 14]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = SMOTEWasting[[i]][[j]]$data)
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 15]] = FS_MRMR[[factor, 15]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = SMOTEWastingMale[[i]][[j]]$data)
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 16]] = FS_MRMR[[factor, 16]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = SMOTEWastingFemale[[i]][[j]]$data)
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 17]] = FS_MRMR[[factor, 17]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = SMOTEWastingUrban[[i]][[j]]$data)
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 18]] = FS_MRMR[[factor, 18]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    mrmr = mRMR.data(data = SMOTEWastingNotUrban[[i]][[j]]$data)
    results = mRMR.classic("mRMRe.Filter",
                           data = mrmr,
                           target_indices = 41,
                           feature_count = 10,
                           method = "exhaustive"
                           )
    for (k in 1:10){
      factorInd = results@filters[["41"]][[k,1]]
      factor = names(stunting)[[factorInd]]
      FS_MRMR[[factor, 19]] = FS_MRMR[[factor, 19]] + 1
    }
  }
}
################################################################################
write.csv(FS_MRMR, "FS_MRMR_10.csv")
```



```{r JMI}
#This one is pretty quick.
set.seed(13)
library(praznik)

FS_JMI = data.frame(Stunting = double(),
                     StuntingMale = double(),
                     StuntingFemale = double(),
                     StuntingUrban = double(),
                     StuntingNotUrban = double(),
                     StuntingYouth = double(),
                     StuntingAdolescent = double(),
                     
                     Thinness = double(),
                     ThinnessMale = double(),
                     ThinnessFemale = double(),
                     ThinnessUrban = double(),
                     ThinnessNotUrban = double(),
                     ThinnessYouth = double(),
                     ThinnessAdolescent = double(),
                     
                     Wasting = double(),
                     WastingMale = double(),
                     WastingFemale = double(), 
                     WastingUrban = double(), 
                     WastingNotUrban = double()
                     )
for (i in 1:40){
 FS_JMI[i,] = 0
}
row.names(FS_JMI) = names(stunting)[1:40]
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(UBStunting[[i]][[j]][1:40],
              UBStunting[[i]][[j]]$Stunting,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 1]] = FS_JMI[[factor, 1]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(UBStuntingMale[[i]][[j]][1:40],
              UBStuntingMale[[i]][[j]]$Stunting,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 2]] = FS_JMI[[factor, 2]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(SMOTEStuntingFemale[[i]][[j]]$data[1:40],
              SMOTEStuntingFemale[[i]][[j]]$data$Stunting,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 3]] = FS_JMI[[factor, 3]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(UBStuntingUrban[[i]][[j]][1:40],
              UBStuntingUrban[[i]][[j]]$Stunting,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 4]] = FS_JMI[[factor, 4]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(UBStuntingNotUrban[[i]][[j]][1:40],
              UBStuntingNotUrban[[i]][[j]]$Stunting,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 5]] = FS_JMI[[factor, 5]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(UBStuntingYouth[[i]][[j]][1:40],
              UBStuntingYouth[[i]][[j]]$Stunting,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 6]] = FS_JMI[[factor, 6]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(UBStuntingAdolescent[[i]][[j]][1:40],
              UBStuntingAdolescent[[i]][[j]]$Stunting,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 7]] = FS_JMI[[factor, 7]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(SMOTEThinness[[i]][[j]]$data[1:40],
              SMOTEThinness[[i]][[j]]$data$Thinness,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 8]] = FS_JMI[[factor, 8]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(SMOTEThinnessMale[[i]][[j]]$data[1:40],
              SMOTEThinnessMale[[i]][[j]]$data$Thinness,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 9]] = FS_JMI[[factor, 9]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(SMOTEThinnessFemale[[i]][[j]]$data[1:40],
              SMOTEThinnessFemale[[i]][[j]]$data$Thinness,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 10]] = FS_JMI[[factor, 10]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(SMOTEThinnessUrban[[i]][[j]]$data[1:40],
              SMOTEThinnessUrban[[i]][[j]]$data$Thinness,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 11]] = FS_JMI[[factor, 11]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(SMOTEThinnessNotUrban[[i]][[j]]$data[1:40],
              SMOTEThinnessNotUrban[[i]][[j]]$data$Thinness,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 12]] = FS_JMI[[factor, 12]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(SMOTEThinnessYouth[[i]][[j]]$data[1:40],
              SMOTEThinnessYouth[[i]][[j]]$data$Thinness,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 13]] = FS_JMI[[factor, 13]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(SMOTEThinnessAdolescent[[i]][[j]]$data[1:40],
              SMOTEThinnessAdolescent[[i]][[j]]$data$Thinness,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 14]] = FS_JMI[[factor, 14]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(SMOTEWasting[[i]][[j]]$data[1:40],
              SMOTEWasting[[i]][[j]]$data$Wasting,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 15]] = FS_JMI[[factor, 15]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(SMOTEWastingMale[[i]][[j]]$data[1:40],
              SMOTEWastingMale[[i]][[j]]$data$Wasting,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 16]] = FS_JMI[[factor, 16]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(SMOTEWastingFemale[[i]][[j]]$data[1:40],
              SMOTEWastingFemale[[i]][[j]]$data$Wasting,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 17]] = FS_JMI[[factor, 17]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(SMOTEWastingUrban[[i]][[j]]$data[1:40],
              SMOTEWastingUrban[[i]][[j]]$data$Wasting,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 18]] = FS_JMI[[factor, 18]] + 1
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    jmi = JMI(SMOTEWastingNotUrban[[i]][[j]]$data[1:40],
              SMOTEWastingNotUrban[[i]][[j]]$data$Wasting,
              k = 10
              )
    for (k in 1:10){
      factor = names(stunting)[jmi$selection[[k]]]
      FS_JMI[[factor, 19]] = FS_JMI[[factor, 19]] + 1
    }
  }
}
################################################################################
write.csv(FS_JMI, "FS_JMI_10.csv")
```



```{r Repeated Univariate Logistic Regression (FS), warning = FALSE}
#This one takes ~15 minutes.
#Repeated Univariate Logistic Regression for FS in training models
set.seed(13)

library(broom)
library(car)
library(performance)
library(MASS)

results = data.frame(StuntingRejects = double(),
                     StuntingMaleRejects = double(),
                     StuntinFemaleRejects = double(),
                     StuntingUrbanRejects = double(),
                     StuntingNotUrbanRejects = double(),
                     StuntingYouthRejects = double(),
                     StuntingAdolescentRejects = double(),
                     
                     ThinnessRejects = double(),
                     ThinnessMaleRejects = double(),
                     StuntinFemaleRejects = double(),
                     ThinnessUrbanRejects = double(),
                     ThinnessNotUrbanRejects = double(),
                     ThinnessYouthRejects = double(),
                     ThinnessAdolescentRejects = double(),
                     
                     WastingRejects = double(),
                     WastingMaleRejects = double(),
                     StuntinFemaleRejects = double(), 
                     WastingUrbanRejects = double(), 
                     WastingNotUrbanRejects = double()
                     )
################################################################################
#Stunting PV-based feature selection & crude odds ratios
for (factor in names(stunting)[1:40]){
  results[[factor, 1]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Stunting","~", factor),
                    data = UBStunting[[i]][[j]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 1]] = results[[factor, 1]] + 1
        }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 2]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Stunting","~", factor),
                    data = UBStuntingMale[[i]][[j]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 2]] = results[[factor, 2]] + 1
        }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 3]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Stunting","~", factor),
                    data = SMOTEStuntingFemale[[i]][[j]][["data"]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 3]] = results[[factor, 3]] + 1
        }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 4]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Stunting","~", factor),
                    data = UBStuntingUrban[[i]][[j]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 4]] = results[[factor, 4]] + 1
        }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 5]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Stunting","~", factor),
                    data = UBStuntingNotUrban[[i]][[j]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 5]] = results[[factor, 5]] + 1
        }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 6]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Stunting","~", factor),
                    data = UBStuntingYouth[[i]][[j]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 6]] = results[[factor, 6]] + 1
        }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 7]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Stunting","~", factor),
                    data = UBStuntingAdolescent[[i]][[j]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 7]] = results[[factor, 7]] + 1
        }
    }
  }
}
################################################################################
#Thinness PV-based feature selection & crude odds ratios
for (factor in names(stunting)[1:40]){
  results[[factor, 8]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Thinness","~",factor),
                    data = SMOTEThinness[[i]][[j]][["data"]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 8]] = results[[factor, 8]] + 1
        }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 9]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Thinness","~",factor),
                    data = SMOTEThinnessMale[[i]][[j]][["data"]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 9]] = results[[factor, 9]] + 1
        }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 10]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Thinness","~",factor),
                    data = SMOTEThinnessFemale[[i]][[j]][["data"]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 10]] = results[[factor, 10]] + 1
        }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 11]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Thinness","~",factor),
                    data = SMOTEThinnessUrban[[i]][[j]][["data"]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 11]] = results[[factor, 11]] + 1
        }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 12]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Thinness","~",factor),
                    data = SMOTEThinnessNotUrban[[i]][[j]][["data"]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 12]] = results[[factor, 12]] + 1
        }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 13]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Thinness","~",factor),
                    data = SMOTEThinnessYouth[[i]][[j]][["data"]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 13]] = results[[factor, 13]] + 1
        }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 14]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Thinness","~",factor),
                    data = SMOTEThinnessAdolescent[[i]][[j]][["data"]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 14]] = results[[factor, 14]] + 1
        }
    }
  }
}
################################################################################
#WastingYoung PV-based feature selection & crude odds ratios
for (factor in names(stunting)[1:40]){
  results[[factor, 15]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Wasting","~",factor),
                    data = SMOTEWasting[[i]][[j]][["data"]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 15]] = results[[factor, 15]] + 1
        }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 16]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Wasting","~",factor),
                    data = SMOTEWastingMale[[i]][[j]][["data"]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 16]] = results[[factor, 16]] + 1
        }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 17]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Wasting","~",factor),
                    data = SMOTEWastingFemale[[i]][[j]][["data"]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 17]] = results[[factor, 17]] + 1
        }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 18]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Wasting","~",factor),
                    data = SMOTEWastingUrban[[i]][[j]][["data"]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 18]] = results[[factor, 18]] + 1
        }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 19]] = 0
  for (i in 1:10){
    for (j in 1:10){
        UVLoR = glm(paste0("Wasting","~",factor),
                    data = SMOTEWastingNotUrban[[i]][[j]][["data"]],
                    family = "binomial"
                    )
        regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
        if (!is.na(regSummary[[2, 5]]) && regSummary[[2, 5]] < 0.05){
          results[[factor, 19]] = results[[factor, 19]] + 1
        }
    }
  }
}
################################################################################
write.csv(results, "FS_R-UVLoR.csv")
```



```{r Repeated Multivariate Logistic Regression (FS), warning = FALSE}
#Takes ~2 minutes.
results = data.frame(StuntingRejects = double(),
                     StuntingMaleRejects = double(),
                     StuntinFemaleRejects = double(),
                     StuntingUrbanRejects = double(),
                     StuntingNotUrbanRejects = double(),
                     StuntingYouthRejects = double(),
                     StuntingAdolescentRejects = double(),
                     
                     ThinnessRejects = double(),
                     ThinnessMaleRejects = double(),
                     StuntinFemaleRejects = double(),
                     ThinnessUrbanRejects = double(),
                     ThinnessNotUrbanRejects = double(),
                     ThinnessYouthRejects = double(),
                     ThinnessAdolescentRejects = double(),
                     
                     WastingRejects = double(),
                     WastingMaleRejects = double(),
                     StuntinFemaleRejects = double(), 
                     WastingUrbanRejects = double(), 
                     WastingNotUrbanRejects = double()
                     )
################################################################################
#Stunting PV-based feature selection & approximate odds ratios
for (factor in names(stunting)[1:40]){
  results[[factor, 1]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Stunting~.,
                data = UBStunting[[i]][[j]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 1]] = results[[factor, 1]] + 1
      }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 2]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Stunting~.,
                data = UBStuntingMale[[i]][[j]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 2]] = results[[factor, 2]] + 1
      }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 3]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Stunting~.,
                data = SMOTEStuntingFemale[[i]][[j]][["data"]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 3]] = results[[factor, 3]] + 1
      }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 4]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Stunting~.,
                data = UBStuntingUrban[[i]][[j]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 4]] = results[[factor, 4]] + 1
      }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 5]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Stunting~.,
                data = UBStuntingNotUrban[[i]][[j]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 5]] = results[[factor, 5]] + 1
      }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 6]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Stunting~.,
                data = UBStuntingYouth[[i]][[j]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 6]] = results[[factor, 6]] + 1
      }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 7]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Stunting~.,
                data = UBStuntingAdolescent[[i]][[j]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 7]] = results[[factor, 7]] + 1
      }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 8]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Thinness~.,
                data = SMOTEThinness[[i]][[j]][["data"]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 8]] = results[[factor, 8]] + 1
      }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 9]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Thinness~.,
                data = SMOTEThinnessMale[[i]][[j]][["data"]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 9]] = results[[factor, 9]] + 1
      }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 10]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Thinness~.,
                data = SMOTEThinnessFemale[[i]][[j]][["data"]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 10]] = results[[factor, 11]] + 1
      }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 11]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Thinness~.,
                data = SMOTEThinnessUrban[[i]][[j]][["data"]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 11]] = results[[factor, 11]] + 1
      }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 12]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Thinness~.,
                data = SMOTEThinnessNotUrban[[i]][[j]][["data"]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 12]] = results[[factor, 12]] + 1
      }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 13]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Thinness~.,
                data = SMOTEThinnessYouth[[i]][[j]][["data"]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 13]] = results[[factor, 13]] + 1
      }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 14]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Thinness~.,
                data = SMOTEThinnessAdolescent[[i]][[j]][["data"]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 14]] = results[[factor, 14]] + 1
      }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 15]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Wasting~.,
                data = SMOTEWasting[[i]][[j]][["data"]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 15]] = results[[factor, 15]] + 1
      }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 16]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Wasting~.,
                data = SMOTEWastingMale[[i]][[j]][["data"]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 16]] = results[[factor, 16]] + 1
      }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 17]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Wasting~.,
                data = SMOTEWastingFemale[[i]][[j]][["data"]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 17]] = results[[factor, 17]] + 1
      }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 18]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Wasting~.,
                data = SMOTEWastingUrban[[i]][[j]][["data"]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 18]] = results[[factor, 18]] + 1
      }
    }
  }
}
################################################################################
for (factor in names(stunting)[1:40]){
  results[[factor, 19]] = 0 #Must instantiate columns or next lines can't access them
}

for (i in 1:10){
  for (j in 1:10){
    index = 0
    UVLoR = glm(Wasting~.,
                data = SMOTEWastingNotUrban[[i]][[j]][["data"]],
                family = "binomial"
                )
    regSummary = tidy(UVLoR, exponentiate = TRUE, conf.level = 0.95)
    for (factor in names(stunting)[1:40]){
      index = index + 1
      if (!is.na(regSummary[[index, 5]]) && regSummary[[index, 5]] < 0.05){
        results[[factor, 19]] = results[[factor, 19]] + 1
      }
    }
  }
}
################################################################################
write.csv(results, "FS_R-MVLoR.csv")
```



```{r Chi-Squared Test, warning = FALSE}
set.seed(13)
library(plyr)

FS_ChiSq = data.frame(StuntingRejects = double(),
                     StuntingMaleRejects = double(),
                     StuntingFemaleRejects = double(),
                     StuntingUrbanRejects = double(),
                     StuntingNotUrbanRejects = double(),
                     StuntingYouthRejects = double(),
                     StuntingAdolescentRejects = double(),
                     
                     ThinnessRejects = double(),
                     ThinnessMaleRejects = double(),
                     ThinnessFemaleRejects = double(),
                     ThinnessUrbanRejects = double(),
                     ThinnessNotUrbanRejects = double(),
                     ThinnessYouthRejects = double(),
                     ThinnessAdolescentRejects = double(),
                     
                     WastingRejects = double(),
                     WastingMaleRejects = double(),
                     WastingFemaleRejects = double(), 
                     WastingUrbanRejects = double(), 
                     WastingNotUrbanRejects = double()
                     )
for (i in 1:40){
 FS_ChiSq[i,] = 0
}
row.names(FS_ChiSq) = names(stunting)[1:40]
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(UBStunting[[i]][[j]][,factor],
                               UBStunting[[i]][[j]]$Stunting)
                         )
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 1]] = FS_ChiSq[[factor, 1]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(UBStuntingMale[[i]][[j]][,factor],
                               UBStuntingMale[[i]][[j]]$Stunting)
                         )
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 2]] = FS_ChiSq[[factor, 2]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(round(SMOTEStuntingFemale[[i]][[j]]$data[,factor],
                                     digits = 0),
                               SMOTEStuntingFemale[[i]][[j]]$data$Stunting
                         ))
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 3]] = FS_ChiSq[[factor, 3]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(UBStuntingUrban[[i]][[j]][,factor],
                               UBStuntingUrban[[i]][[j]]$Stunting)
                         )
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 4]] = FS_ChiSq[[factor, 4]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(UBStuntingNotUrban[[i]][[j]][,factor],
                               UBStuntingNotUrban[[i]][[j]]$Stunting)
                         )
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 5]] = FS_ChiSq[[factor, 5]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(UBStuntingYouth[[i]][[j]][,factor],
                               UBStuntingYouth[[i]][[j]]$Stunting)
                         )
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 6]] = FS_ChiSq[[factor, 6]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(UBStuntingAdolescent[[i]][[j]][,factor],
                               UBStuntingAdolescent[[i]][[j]]$Stunting)
                         )
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 7]] = FS_ChiSq[[factor, 7]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(round(SMOTEThinness[[i]][[j]]$data[,factor],
                                     digits = 0),
                               SMOTEThinness[[i]][[j]]$data$Thinness
                         ))
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 8]] = FS_ChiSq[[factor, 8]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(round(SMOTEThinnessMale[[i]][[j]]$data[,factor],
                                     digits = 0),
                               SMOTEThinnessMale[[i]][[j]]$data$Thinness
                         ))
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 9]] = FS_ChiSq[[factor, 9]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(round(SMOTEThinnessFemale[[i]][[j]]$data[,factor],
                                     digits = 0),
                               SMOTEThinnessFemale[[i]][[j]]$data$Thinness
                         ))
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 10]] = FS_ChiSq[[factor, 10]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(round(SMOTEThinnessUrban[[i]][[j]]$data[,factor],
                                     digits = 0),
                               SMOTEThinnessUrban[[i]][[j]]$data$Thinness
                         ))
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 11]] = FS_ChiSq[[factor, 11]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(round(SMOTEThinnessNotUrban[[i]][[j]]$data[,factor],
                                     digits = 0),
                               SMOTEThinnessNotUrban[[i]][[j]]$data$Thinness
                         ))
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 12]] = FS_ChiSq[[factor, 12]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(round(SMOTEThinnessYouth[[i]][[j]]$data[,factor],
                                     digits = 0),
                               SMOTEThinnessYouth[[i]][[j]]$data$Thinness
                         ))
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 13]] = FS_ChiSq[[factor, 13]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(round(SMOTEThinnessAdolescent[[i]][[j]]$data[,factor],
                                     digits = 0),
                               SMOTEThinnessAdolescent[[i]][[j]]$data$Thinness
                         ))
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 14]] = FS_ChiSq[[factor, 14]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(round(SMOTEWasting[[i]][[j]]$data[,factor],
                                     digits = 0),
                               SMOTEWasting[[i]][[j]]$data$Wasting
                         ))
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 15]] = FS_ChiSq[[factor, 15]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(round(SMOTEWastingMale[[i]][[j]]$data[,factor],
                                     digits = 0),
                               SMOTEWastingMale[[i]][[j]]$data$Wasting
                         ))
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 16]] = FS_ChiSq[[factor, 16]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(round(SMOTEWastingFemale[[i]][[j]]$data[,factor],
                                     digits = 0),
                               SMOTEWastingFemale[[i]][[j]]$data$Wasting
                         ))
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 17]] = FS_ChiSq[[factor, 17]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(round(SMOTEWastingUrban[[i]][[j]]$data[,factor],
                                     digits = 0),
                               SMOTEWastingUrban[[i]][[j]]$data$Wasting
                         ))
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 18]] = FS_ChiSq[[factor, 18]] + 1
      }
    }
  }
}
################################################################################
for (i in 1:10){
  for (j in 1:10){
    for (factor in 1:40){
      #cat(names(UBStunting[[i]][[j]])[factor],"\n")
      chisq = chisq.test(table(round(SMOTEWastingNotUrban[[i]][[j]]$data[,factor],
                                     digits = 0),
                               SMOTEWastingNotUrban[[i]][[j]]$data$Wasting
                         ))
      if (chisq$p.value < 0.05){
        FS_ChiSq[[factor, 19]] = FS_ChiSq[[factor, 19]] + 1
      }
    }
  }
}
################################################################################
write.csv(FS_ChiSq, "FS_ChiSq.csv")
```



#####
# CLASSIFIER MODELLING:
#####
```{r Classifer Model Data Preparation}
#Creating train/test sets of selected features from original datasets for use in classifier modelling.
TEST = list(Stunting = testSetsStunting,
                Thinness = testSetsThinness,
                Wasting = testSetsWasting
            )

TRAINING = list(Stunting = list(None = list(),
                                MVLoR = list(),
                                IG = list(),
                                MRMR = list(),
                                JMI = list()
                                ),
                Thinness = list(None = list(),
                                MVLoR = list(),
                                IG = list(),
                                MRMR = list(),
                                JMI = list()
                                ),
                Wasting = list(None = list(),
                                MVLoR = list(),
                                IG = list(),
                                MRMR = list(),
                                JMI = list()
                                )
                )
################################################################################
#These are the correct indices of the features we want to keep for our classifier models, but this isn't functional yet. We have to go through all 100 training sets per malnutrition type and subset these indices.
TRAINING[[1]][["None"]] = UBStunting
TRAINING[[1]][["MVLoR"]] = UBStunting
for (i in 1:10){
  for (j in 1:10){
    TRAINING[[1]][["MVLoR"]][[i]][[j]] = TRAINING[[1]][[2]][[i]][[j]][,c(1,2,4,41)]
  }
}
TRAINING[[1]][["IG"]] = NA #IG
TRAINING[[1]][["MRMR"]] = UBStunting
for (i in 1:10){
  for (j in 1:10){
    TRAINING[[1]][["MRMR"]][[i]][[j]] = TRAINING[[1]][["MRMR"]][[i]][[j]][,c(1,2,4,12,36,41)]
  }
}
TRAINING[[1]][["JMI"]] = UBStunting
for (i in 1:10){
  for (j in 1:10){
    TRAINING[[1]][["JMI"]][[i]][[j]] = TRAINING[[1]][["JMI"]][[i]][[j]][,c(1:4,41)]
  }
}
################################################################################
TRAINING[[2]][["None"]] = SMOTEThinness
for (i in 1:10){
  for (j in 1:10){
    TRAINING[[2]][["None"]][[i]][[j]] = TRAINING[[2]][["None"]][[i]][[j]]$data
  }
}
TRAINING[[2]][["MVLoR"]] = NA
TRAINING[[2]][["IG"]] = SMOTEThinness
for (i in 1:10){
  for (j in 1:10){
    TRAINING[[2]][["IG"]][[i]][[j]] = TRAINING[[2]][["IG"]][[i]][[j]]$data[,c(5,8,24,41)]
  }
}
TRAINING[[2]][["MRMR"]] = NA
TRAINING[[2]][["JMI"]] = SMOTEThinness
for (i in 1:10){
  for (j in 1:10){
    TRAINING[[2]][["JMI"]][[i]][[j]] = TRAINING[[2]][["JMI"]][[i]][[j]]$data[,c(5,8,23,41)]
  }
}
#TRAINING[[2]][["JMI"]] = thinness[,c(5, 8, 23, 41)] #JMI
################################################################################
TRAINING[[3]][["None"]] = SMOTEWasting
for (i in 1:10){
  for (j in 1:10){
    TRAINING[[3]][["None"]][[i]][[j]] = TRAINING[[3]][["None"]][[i]][[j]]$data
  }
}
TRAINING[[3]][["MVLoR"]] = SMOTEWasting
for (i in 1:10){
  for (j in 1:10){
    TRAINING[[3]][["MVLoR"]][[i]][[j]] = TRAINING[[3]][["MVLoR"]][[i]][[j]]$data[,c(1,41)]
  }
}
TRAINING[[3]][["IG"]] = TRAINING[[3]][["MVLoR"]]
TRAINING[[3]][["MRMR"]] = TRAINING[[3]][["MVLoR"]]
TRAINING[[3]][["JMI"]] = SMOTEWasting #None
for (i in 1:10){
  for (j in 1:10){
    TRAINING[[3]][["JMI"]][[i]][[j]] = TRAINING[[3]][["JMI"]][[i]][[j]]$data[,c(1,12,41)]
  }
}
```



```{r Random Forest}
set.seed(13)
library(randomForest)
library(datasets)
library(caret)

RF_Accuracy = data.frame(StuntingNone = double(),
                         StuntingMVLoR = double(),
                         StuntingIG = double(),
                         StuntingMRMR = double(),
                         StuntingJMI = double(),
                         
                         ThinnessNone = double(),
                         ThinnessMVLoR = double(),
                         ThinnessIG = double(),
                         ThinnessMRMR = double(),
                         ThinnessJMI = double(),
                         
                         WastingNone = double(),
                         WastingMVLoR = double(),
                         WastingIG = double(),
                         WastingMRMR = double(),
                         WastingJMI = double()
                         )
RF_F1 = RF_Accuracy

control = trainControl(method = "repeatedcv", 
                       number = 100,
                       repeats = 100, 
                       search = 'grid')

control.F1 = trainControl(method = "repeatedcv", 
                          number = 100,
                          repeats = 100, 
                          search = 'grid', 
                          summaryFunction = prSummary,
                          savePredictions = TRUE)

tune.grid = expand.grid(.mtry = (1:3))
################################################################################
# RF = train(paste0(dep,"~."),
#       data = train,
#       method = "rf",
#       trControl = control.F1,
#       tuneGrid = tune.grid,
#       metric = 'F'
#       )
#   print(RF$bestTune)
#   RFPred = predict(as.list(RF), as.data.frame(test))
#   assign(paste0('cm_',i),
#          confusionMatrix(RFPred,
#                          as.factor(test),
#                          mode = 'everything')
#          )

# avg_accNoFS = (cm_1$overall[1] + cm_2$overall[1] + cm_3$overall[1] + cm_4$overall[1] + cm_5$overall[1])/5
# avg_accNoFS
# 
# avg_F1NoFS = (cm_1$byClass[7] + cm_2$byClass[7] + cm_3$byClass[7] + cm_4$byClass[7] + cm_5$byClass[7])/5
# avg_F1NoFS




for (i in 1:3){
  if (i == 1){
    dep = "Stunting"
  }else if (i == 2){
    dep = "Thinness"
  }else{
    dep = "Wasting"
  }
  for (j in 1:5){
    if (is.na(TRAINING[i][j])){
          next
    }
    for (k in 1:10){
      for (l in 1:10){
        test = TEST[[i]][[k]]
        test[,ncol(test)] = as.factor(as.character(test[,ncol(test)]))
        train = TRAINING[[i]][[j]][[k]][[l]]
        train[,ncol(train)] = as.factor(as.character(train[,ncol(train)]))
        RF = train(as.formula(paste0(dep,"~.")),
                   data = train,
                   method = "rf",
                   trControl = control.F1,
                   tuneGrid = tune.grid,
                   metric = 'F'
                   )
        print(RF$bestTune)
        RFPred = predict(as.list(RF), as.data.frame(test))
        assign(paste0('cm_',i),
               confusionMatrix(RFPred,
                               as.factor(test),
                               mode = 'everything'
                               )
               )
        
        # 
        # test = TEST[[i]][[k]]
        # test[,ncol(test)] = as.factor(as.character(test[,ncol(test)]))
        # train = TRAINING[[i]][[j]][[k]][[l]]
        # train[,ncol(train)] = as.factor(as.character(train[,ncol(train)]))
        # RFTrain = train(paste0(dep,"~."),
        #                 data = train,
        #                 method = "rf",
        #                 tuneGrid = tune.Grid
        #                 )
        # RFTrain = randomForest::randomForest(paste0(dep,"~."),
        #                                      data = train,
        #                                      proximity = TRUE,
        #                                      xtest = test,
        #                                      ytest = test[,ncol(test)]
        #                                      )
        #RFTrain$test$confusion
      }
    }
  }
}

```



```{r Support Vector Machine}
set.seed(13)
library(e1071)
 
classifier = svm(formula = Stunting~.,
                 data = train,
                 type = 'C-classification',
                 kernel = 'linear')
y = predict(classifier, test)
```



```{r Extreme Gradient Boosting}
set.seed(13)
library(xgboost)
library(caret)
library(tidyverse)

XGB = train(data = train,
            max.depth = 2,
            eta = 1,
            nthread = 2,
            nrounds = 2,
            objective = "binary:logistic",
            verbose = 0
            )
XGBPred = predict(XGB, test)
XGBPred = as.numeric(XGBPred > 0.5)
```



```{r Multivariate Logistic Regression (OR), warning = FALSE}
#This MVLoR is for Odds Ratios, uses entire dataset.
#NOT used for feature selection for classifier models; do not mistake this data for the training/test set-derived repeated multivariate logistic regression above.
#library(devtools)
library(broom)
library(car)
library(performance)
library(MASS)
library(leaps)

OR_Stunting = glm(Stunting~., data = stunting, family = "binomial")
write.csv(cbind(
          tidy(OR_Stunting, exponentiate = TRUE, conf.level = 0.95),
          p.adjust(summary(OR_Stunting)$coefficients[1:41,4],method = "BH"),
          exp(confint(OR_Stunting))),
          "MVLoR_Stunting.csv"
          )

StepStunting = stepAIC(OR_Stunting, direction = "both", trace = FALSE)   # Stepwise regression model
write.csv(cbind(
          tidy(StepStunting, exponentiate = TRUE, conf.level = 0.95),
          p.adjust(summary(StepStunting)$coefficients[,4],method = "BH"),
          exp(confint(StepStunting))),
          "MVLoR_SW_Stunting.csv"
          )

LIN_Stunting = lm(Stunting~., data = stunting)
write.csv(cbind(
          tidy(LIN_Stunting, conf.level = 0.95),
          p.adjust(summary(LIN_Stunting)$coefficients[1:41,4],method = "BH"),
          confint(LIN_Stunting)),
          "MVLiR_Stunting.csv"
          )

StepLINStunting = stepAIC(LIN_Stunting, direction = "both", trace = FALSE)
write.csv(cbind(
          tidy(StepLINStunting, conf.level = 0.95),
          p.adjust(summary(StepLINStunting)$coefficients[,4],method = "BH"),
          confint(StepLINStunting)),
          "MVLiR_SW_Stunting.csv"
          )

summary(regsubsets(Stunting~., data = stunting, nvmax = 5, method = "forward"))$adjr2
################################################################################
OR_Thinness = glm(Thinness~., data = thinness, family = "binomial")
write.csv(cbind(
          tidy(OR_Thinness, exponentiate = TRUE, conf.level = 0.95),
          p.adjust(summary(OR_Thinness)$coefficients[1:41,4],method = "BH"),
          exp(confint(OR_Thinness))),
          "OR_Thinness.csv"
          )
StepThinness = stepAIC(OR_Thinness, direction = "both", trace = FALSE)   # Stepwise regression model
write.csv(cbind(
          tidy(StepThinness, exponentiate = TRUE, conf.level = 0.95),
          p.adjust(summary(StepThinness)$coefficients[,4],method = "BH"),
          exp(confint(StepThinness))),
          "MVLoR_SW_Thinness.csv"
          )

LIN_Thinness = lm(Thinness~., data = thinness)
write.csv(cbind(
          tidy(LIN_Thinness, conf.level = 0.95),
          p.adjust(summary(LIN_Thinness)$coefficients[1:41,4],method = "BH"),
          confint(LIN_Thinness)),
          "MVLiR_Thinness.csv"
          )

StepLINThinness = stepAIC(LIN_Thinness, direction = "both", trace = FALSE)
write.csv(cbind(
          tidy(StepLINThinness, conf.level = 0.95),
          p.adjust(summary(StepLINThinness)$coefficients[,4],method = "BH"),
          confint(StepLINThinness)),
          "MVLiR_SW_Thinness.csv"
          )
################################################################################
OR_Wasting = glm(Wasting~., data = wasting, family = "binomial")
write.csv(cbind(
          tidy(OR_Wasting, exponentiate = TRUE, conf.level = 0.95),
          p.adjust(summary(OR_Wasting)$coefficients[1:41,4],method = "BH"),
          exp(confint(OR_Wasting))),
          "OR_Wasting.csv"
          )
StepWasting = stepAIC(OR_Wasting, direction = "both", trace = FALSE)   # Stepwise regression model
write.csv(cbind(
          tidy(StepWasting, exponentiate = TRUE, conf.level = 0.95),
          p.adjust(summary(StepWasting)$coefficients[,4],method = "BH"),
          exp(confint(StepWasting))),
          "MVLoR_SW_Wasting.csv"
          )

LIN_Wasting = lm(Wasting~., data = wasting)
write.csv(cbind(
          tidy(LIN_Wasting, conf.level = 0.95),
          p.adjust(summary(LIN_Wasting)$coefficients[1:41,4],method = "BH"),
          confint(LIN_Wasting)),
          "MVLiR_Wasting.csv"
          )

StepLINWasting = stepAIC(LIN_Wasting, direction = "both", trace = FALSE)
write.csv(cbind(
          tidy(StepLINWasting, conf.level = 0.95),
          p.adjust(summary(StepLINWasting)$coefficients[,4],method = "BH"),
          confint(StepLINWasting)),
          "MVLiR_SW_Wasting.csv"
          )

```

#####
# ASSOCIATION RULE LEARNING:
#####
# ```{r ARL Data Preparation, warning = FALSE}
# #Preparing SMOTE-balancing of entire datasets for use in association rule learning. Datasets previously balanced with SMOTE were only training data for use in Feature Selection, and thus were subsets of ~81% of the original data. Ours will use the remaining 19% for ARL.
# #I.e. The SMOTE balancing we did before didn't include everything, but we want everything for ARL. So now we have to make new balanced datasets with everything in them.
# 
# ARL_Stunting_Older = SMOTE(X = stunting,
#                      target = stunting$Stunting,
#                      K = 5,
#                      dup_size = 2
#                      )
# ARL_Stunting_Older = ARL_Stunting_Older$data
# barplot(prop.table(table(ARL_Stunting_Older$Stunting)),
#         col = c("white", "darkgrey"),
#         ylim = c(0, 1),
#         xlim = c(0, 3),
#         ylab = "Prevalence (%)",
#         xlab = "Stunting",
#         names = c("No", "Yes"),
#         main = 'ARL_Stunting_Older SMOTE-Balanced Dataset Class Distribution'
#         )
# abline(h = 0)
# ################################################################################
# ARL_Thinness_Older = SMOTE(X = thinness,
#                      target = thinness$Thinness,
#                      K = 5,
#                      dup_size = 22
#                      )
# ARL_Thinness_Older = ARL_Thinness_Older$data
# barplot(prop.table(table(ARL_Thinness_Older$Thinness)),
#         col = c("white", "darkgrey"),
#         ylim = c(0, 1),
#         xlim = c(0, 3),
#         ylab = "Prevalence (%)",
#         xlab = "Stunting",
#         names = c("No", "Yes"),
#         main = 'ARL_Thinness_Older SMOTE-Balanced Dataset Class Distribution'
#         )
# abline(h = 0)
# ################################################################################
# ARL_Stunting_Young = SMOTE(X = StuntingYoung,
#                      target = StuntingYoung$Stunting,
#                      K = 5,
#                      dup_size = 3
#                      )
# ARL_Stunting_Young = ARL_Stunting_Young$data
# barplot(prop.table(table(ARL_Stunting_Young$Stunting)),
#         col = c("white", "darkgrey"),
#         ylim = c(0, 1),
#         xlim = c(0, 3),
#         ylab = "Prevalence (%)",
#         xlab = "Stunting",
#         names = c("No", "Yes"),
#         main = 'ARL_Stunting_Young SMOTE-Balanced Dataset Class Distribution'
#         )
# abline(h = 0)
# ################################################################################
# ARL_Thinness_Young = SMOTE(X = thinnessYoung,
#                      target = thinnessYoung$Thinness,
#                      K = 5,
#                      dup_size = 30
#                      )
# ARL_Thinness_Young = ARL_Thinness_Young$data
# barplot(prop.table(table(ARL_Thinness_Young$Thinness)),
#         col = c("white", "darkgrey"),
#         ylim = c(0, 1),
#         xlim = c(0, 3),
#         ylab = "Prevalence (%)",
#         xlab = "Stunting",
#         names = c("No", "Yes"),
#         main = 'ARL_Thinness_Young SMOTE-Balanced Dataset Class Distribution'
#         )
# abline(h = 0)
# ################################################################################
# ARL_Wasting_Young = SMOTE(X = WastingYoung,
#                      target = WastingYoung$Wasting,
#                      K = 5,
#                      dup_size = 9
#                      )
# ARL_Wasting_Young = ARL_Wasting_Young$data
# barplot(prop.table(table(ARL_Wasting_Young$Wasting)),
#         col = c("white", "darkgrey"),
#         ylim = c(0, 1),
#         xlim = c(0, 3),
#         ylab = "Prevalence (%)",
#         xlab = "Stunting",
#         names = c("No", "Yes"),
#         main = 'ARL_Wasting_Young SMOTE-Balanced Dataset Class Distribution'
#         )
# abline(h = 0)
# ################################################################################
# ARL_Stunting_Male = subset(StuntingFull, Sex == 0)
# ARL_Stunting_Male = SMOTE(X = ARL_Stunting_Male,
#                      target = ARL_Stunting_Male$Stunting,
#                      K = 5,
#                      dup_size = 2
#                      )
# ARL_Stunting_Male = ARL_Stunting_Male$data
# barplot(prop.table(table(ARL_Stunting_Male$Stunting)),
#         col = c("white", "darkgrey"),
#         ylim = c(0, 1),
#         xlim = c(0, 3),
#         ylab = "Prevalence (%)",
#         xlab = "Stunting",
#         names = c("No", "Yes"),
#         main = 'ARL_Stunting_Male SMOTE-Balanced Dataset Class Distribution'
#         )
# abline(h = 0)
# ################################################################################
# ARL_Stunting_Female = subset(StuntingFull, Sex == 1)
# ARL_Stunting_Female = SMOTE(X = ARL_Stunting_Female,
#                      target = ARL_Stunting_Female$Stunting,
#                      K = 5,
#                      dup_size = 3
#                      )
# ARL_Stunting_Female = ARL_Stunting_Female$data
# barplot(prop.table(table(ARL_Stunting_Female$Stunting)),
#         col = c("white", "darkgrey"),
#         ylim = c(0, 1),
#         xlim = c(0, 3),
#         ylab = "Prevalence (%)",
#         xlab = "Stunting",
#         names = c("No", "Yes"),
#         main = 'ARL_Stunting_Female SMOTE-Balanced Dataset Class Distribution'
#         )
# abline(h = 0)
# ################################################################################
# ARL_Thinness_Male = subset(ThinnessFull, Sex == 0)
# ARL_Thinness_Male = SMOTE(X = ARL_Thinness_Male,
#                      target = ARL_Thinness_Male$Thinness,
#                      K = 5,
#                      dup_size = 27
#                      )
# ARL_Thinness_Male = ARL_Thinness_Male$data
# barplot(prop.table(table(ARL_Thinness_Male$Thinness)),
#         col = c("white", "darkgrey"),
#         ylim = c(0, 1),
#         xlim = c(0, 3),
#         ylab = "Prevalence (%)",
#         xlab = "Thinness",
#         names = c("No", "Yes"),
#         main = 'ARL_Thinness_Male SMOTE-Balanced Dataset Class Distribution'
#         )
# abline(h = 0)
# ################################################################################
# ARL_Thinness_Female = subset(ThinnessFull, Sex == 1)
# ARL_Thinness_Female = SMOTE(X = ARL_Thinness_Female,
#                      target = ARL_Thinness_Female$Thinness,
#                      K = 5,
#                      dup_size = 25
#                      )
# ARL_Thinness_Female = ARL_Thinness_Female$data
# barplot(prop.table(table(ARL_Thinness_Female$Thinness)),
#         col = c("white", "darkgrey"),
#         ylim = c(0, 1),
#         xlim = c(0, 3),
#         ylab = "Prevalence (%)",
#         xlab = "Thinness",
#         names = c("No", "Yes"),
#         main = 'ARL_Thinness_Female SMOTE-Balanced Dataset Class Distribution'
#         )
# abline(h = 0)
# ################################################################################
# ARL_Wasting_Male = subset(WastingFull, Sex == 0)
# ARL_Wasting_Male = SMOTE(X = ARL_Wasting_Male,
#                      target = ARL_Wasting_Male$Wasting,
#                      K = 5,
#                      dup_size = 7
#                      )
# ARL_Wasting_Male = ARL_Wasting_Male$data
# barplot(prop.table(table(ARL_Wasting_Male$Wasting)),
#         col = c("white", "darkgrey"),
#         ylim = c(0, 1),
#         xlim = c(0, 3),
#         ylab = "Prevalence (%)",
#         xlab = "Wasting",
#         names = c("No", "Yes"),
#         main = 'ARL_Wasting_Male SMOTE-Balanced Dataset Class Distribution'
#         )
# abline(h = 0)
# ################################################################################
# ARL_Wasting_Female = subset(WastingFull, Sex == 1)
# ARL_Wasting_Female = SMOTE(X = ARL_Wasting_Female,
#                      target = ARL_Wasting_Female$Wasting,
#                      K = 5,
#                      dup_size = 11
#                      )
# ARL_Wasting_Female = ARL_Wasting_Female$data
# barplot(prop.table(table(ARL_Wasting_Female$Wasting)),
#         col = c("white", "darkgrey"),
#         ylim = c(0, 1),
#         xlim = c(0, 3),
#         ylab = "Prevalence (%)",
#         xlab = "Wasting",
#         names = c("No", "Yes"),
#         main = 'ARL_Wasting_Female SMOTE-Balanced Dataset Class Distribution'
#         )
# abline(h = 0)
# ################################################################################
# ARL_Stunting_NotUrban = subset(StuntingFull, Suburban == 1 | Rural == 1)
# ARL_Stunting_NotUrban = SMOTE(X = ARL_Stunting_NotUrban,
#                      target = ARL_Stunting_NotUrban$Stunting,
#                      K = 5,
#                      dup_size = 2
#                      )
# ARL_Stunting_NotUrban = ARL_Stunting_NotUrban$data
# barplot(prop.table(table(ARL_Stunting_NotUrban$Stunting)),
#         col = c("white", "darkgrey"),
#         ylim = c(0, 1),
#         xlim = c(0, 3),
#         ylab = "Prevalence (%)",
#         xlab = "Wasting",
#         names = c("No", "Yes"),
#         main = 'ARL_Stunting_NotUrban SMOTE-Balanced Dataset Class Distribution'
#         )
# abline(h = 0)
# ################################################################################
# ARL_Stunting_Urban = subset(StuntingFull, Rural == 0 & Suburban == 0)
# ARL_Stunting_Urban = SMOTE(X = ARL_Stunting_Urban,
#                      target = ARL_Stunting_Urban$Stunting,
#                      K = 5,
#                      dup_size = 2
#                      )
# ARL_Stunting_Urban = ARL_Stunting_Urban$data
# barplot(prop.table(table(ARL_Stunting_Urban$Stunting)),
#         col = c("white", "darkgrey"),
#         ylim = c(0, 1),
#         xlim = c(0, 3),
#         ylab = "Prevalence (%)",
#         xlab = "Wasting",
#         names = c("No", "Yes"),
#         main = 'ARL_Stunting_Urban SMOTE-Balanced Dataset Class Distribution'
#         )
# abline(h = 0)
# ################################################################################
# ARL_Thinness_NotUrban = subset(ThinnessFull, Suburban == 1 | Rural == 1)
# ARL_Thinness_NotUrban = SMOTE(X = ARL_Thinness_NotUrban,
#                      target = ARL_Thinness_NotUrban$Thinness,
#                      K = 5,
#                      dup_size = 33
#                      )
# ARL_Thinness_NotUrban = ARL_Thinness_NotUrban$data
# barplot(prop.table(table(ARL_Thinness_NotUrban$Thinness)),
#         col = c("white", "darkgrey"),
#         ylim = c(0, 1),
#         xlim = c(0, 3),
#         ylab = "Prevalence (%)",
#         xlab = "Wasting",
#         names = c("No", "Yes"),
#         main = 'ARL_Thinness_NotUrban SMOTE-Balanced Dataset Class Distribution'
#         )
# abline(h = 0)
# ################################################################################
# ARL_Thinness_Urban = subset(ThinnessFull, Rural == 0 & Suburban == 0)
# ARL_Thinness_Urban = SMOTE(X = ARL_Thinness_Urban,
#                      target = ARL_Thinness_Urban$Thinness,
#                      K = 5,
#                      dup_size = 25
#                      )
# ARL_Thinness_Urban = ARL_Thinness_Urban$data
# barplot(prop.table(table(ARL_Thinness_Urban$Thinness)),
#         col = c("white", "darkgrey"),
#         ylim = c(0, 1),
#         xlim = c(0, 3),
#         ylab = "Prevalence (%)",
#         xlab = "Wasting",
#         names = c("No", "Yes"),
#         main = 'ARL_Thinness_Urban SMOTE-Balanced Dataset Class Distribution'
#         )
# abline(h = 0)
# ################################################################################
# ARL_Wasting_NotUrban = subset(WastingFull, Suburban == 1 | Rural == 1)
# ARL_Wasting_NotUrban = SMOTE(X = ARL_Wasting_NotUrban,
#                      target = ARL_Wasting_NotUrban$Wasting,
#                      K = 5,
#                      dup_size = 9
#                      )
# ARL_Wasting_NotUrban = ARL_Wasting_NotUrban$data
# barplot(prop.table(table(ARL_Wasting_NotUrban$Wasting)),
#         col = c("white", "darkgrey"),
#         ylim = c(0, 1),
#         xlim = c(0, 3),
#         ylab = "Prevalence (%)",
#         xlab = "Wasting",
#         names = c("No", "Yes"),
#         main = 'ARL_Wasting_NotUrban SMOTE-Balanced Dataset Class Distribution'
#         )
# abline(h = 0)
# ################################################################################
# ARL_Wasting_Urban = subset(WastingFull, Rural == 0 & Suburban == 0)
# ARL_Wasting_Urban = SMOTE(X = ARL_Wasting_Urban,
#                      target = ARL_Wasting_Urban$Wasting,
#                      K = 5,
#                      dup_size = 9
#                      )
# ARL_Wasting_Urban = ARL_Wasting_Urban$data
# barplot(prop.table(table(ARL_Wasting_Urban$Wasting)),
#         col = c("white", "darkgrey"),
#         ylim = c(0, 1),
#         xlim = c(0, 3),
#         ylab = "Prevalence (%)",
#         xlab = "Wasting",
#         names = c("No", "Yes"),
#         main = 'ARL_Wasting_Urban SMOTE-Balanced Dataset Class Distribution'
#         )
# abline(h = 0)
# ################################################################################
# ```



```{r Association Rule Learning: Stunting & StuntingYoung}
#Pretty quick.
#I played around with support and confidence values until I got ~10 rules per iteration of the Apriori algorithm. 

#https://www.geeksforgeeks.org/apriori-algorithm-in-r-programming/
set.seed(13)

library(arules)
library(arulesViz)

ruleSet = data.frame(rules = character(),
                     support = numeric(),
                     confidence = numeric(),
                     coverage = numeric(),
                     lift = numeric(),
                     count = numeric())
################################################################################
#Male vs. Female associations on Stunting
ruleSet[nrow(ruleSet)+1, 1] = "STUNTING:"
data = data.frame(lapply(stunting, as.logical))


ruleSet[nrow(ruleSet)+1, 1] = "FEMALE:"
female = subset(data, Sex == TRUE)
female = female[,-2]
rules = apriori(female, 
                parameter = list(support = 0.01,
                                 confidence = 0.4,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Stunting")
                                  )
                )
#append(ruleSet, as(rules, "data.frame"))
#inspect(rules[1:10])
ruleSet = rbind(ruleSet, as(rules, "data.frame"))

ruleSet[nrow(ruleSet)+1, 1] = "MALE:"
male = subset(data, Sex == FALSE)
male = male[,-2]
rules = apriori(male, 
                parameter = list(support = 0.01,
                                 confidence = 0.62,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Stunting")
                                  )
                )
ruleSet = rbind(ruleSet, as(rules, "data.frame"))
################################################################################
#Rural & suburban vs. urban rules on Stunting
ruleSet[nrow(ruleSet)+1, 1] = "NOTURBAN:"
rural = subset(data, Urban == FALSE)
rural = rural[,-c(6)]
rules = apriori(rural,
                parameter = list(support = 0.02,
                                 confidence = 0.46,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Stunting")
                                  )
                )
#inspect(rules)
ruleSet = rbind(ruleSet, as(rules, "data.frame"))

ruleSet[nrow(ruleSet)+1, 1] = "URBAN:"
urban = subset(data, Urban == TRUE)
urban = urban[,-c(6)]
rules = apriori(urban, 
                parameter = list(support = 0.01,
                                 confidence = 0.42,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Stunting")
                                  )
                )
#inspect(rules[1:8])
ruleSet = rbind(ruleSet, as(rules, "data.frame"))
################################################################################
ruleSet[nrow(ruleSet)+1, 1] = "STUNTING OVERALL:"
rules = apriori(data.frame(lapply(stunting, as.logical)), 
                parameter = list(support = 0.01,
                                 confidence = 0.39,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Stunting")
                                  )
                )
#inspect(rules[1:10])
ruleSet = rbind(ruleSet, as(rules, "data.frame"))

ruleSet[nrow(ruleSet)+1, 1] = "STUNTINGYOUNG OVERALL:"

rules = apriori(data.frame(lapply(subset(stunting, (Age < 11)), as.logical)), 
                parameter = list(support = 0.01,
                                 confidence = 0.54,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Stunting")
                                  )
                )
#inspect(rules[1:8])
ruleSet = rbind(ruleSet, as(rules, "data.frame"))

ruleSet[nrow(ruleSet)+1, 1] = "STUNTINGADOLESCENT OVERALL:"

rules = apriori(data.frame(lapply(subset(stunting, (Age > 10)), as.logical)), 
                parameter = list(support = 0.01,
                                 confidence = 0.6,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Stunting")
                                  )
                )
#inspect(rules[1:8])
ruleSet = rbind(ruleSet, as(rules, "data.frame"))
```



```{r Association Rule Learning: Thinness}
set.seed(13)
################################################################################
ruleSet[nrow(ruleSet)+1, 1] = "Thinness:"
data = data.frame(lapply(thinness, as.logical))


ruleSet[nrow(ruleSet)+1, 1] = "FEMALE:"
female = subset(data, Sex == TRUE)
female = female[,-2]
rules = apriori(female, 
                parameter = list(support = 0.002,
                                 confidence = 0.3,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Thinness")
                                  )
                )
#append(ruleSet, as(rules, "data.frame"))
#inspect(rules)
ruleSet = rbind(ruleSet, as(rules, "data.frame"))

ruleSet[nrow(ruleSet)+1, 1] = "MALE:"
male = subset(data, Sex == FALSE)
male = male[,-2]
rules = apriori(male, 
                parameter = list(support = 0.002,
                                 confidence = 0.3,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Thinness")
                                  )
                )
ruleSet = rbind(ruleSet, as(rules, "data.frame"))
################################################################################
#Rural & suburban vs. urban rules on Thinness
ruleSet[nrow(ruleSet)+1, 1] = "NOTURBAN:"
rural = subset(data, Urban == FALSE)
rural = rural[,-c(6)]
rules = apriori(rural,
                parameter = list(support = 0.005,
                                 confidence = 0.25,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Thinness")
                                  )
                )
#inspect(rules)
ruleSet = rbind(ruleSet, as(rules, "data.frame"))

ruleSet[nrow(ruleSet)+1, 1] = "URBAN:"
urban = subset(data, Urban == TRUE)
urban = urban[,-c(6)]
rules = apriori(urban, 
                parameter = list(support = 0.002,
                                 confidence = 0.25,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Thinness")
                                  )
                )
#inspect(rules[1:8])
ruleSet = rbind(ruleSet, as(rules, "data.frame"))
################################################################################
ruleSet[nrow(ruleSet)+1, 1] = "Thinness OVERALL:"
rules = apriori(data.frame(lapply(thinness, as.logical)), 
                parameter = list(support = 0.001,
                                 confidence = 0.2,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Thinness")
                                  )
                )
#inspect(rules[1:10])
ruleSet = rbind(ruleSet, as(rules, "data.frame"))

ruleSet[nrow(ruleSet)+1, 1] = "ThinnessYOUNG OVERALL:"

rules = apriori(data.frame(lapply(subset(thinness, (Age < 11)), as.logical)), 
                parameter = list(support = 0.002,
                                 confidence = 0.25,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Thinness")
                                  )
                )
#inspect(rules[1:8])
ruleSet = rbind(ruleSet, as(rules, "data.frame"))

ruleSet[nrow(ruleSet)+1, 1] = "thinnessADOLESCENT OVERALL:"

rules = apriori(data.frame(lapply(subset(thinness, (Age > 10)), as.logical)), 
                parameter = list(support = 0.003,
                                 confidence = 0.2,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Thinness")
                                  )
                )
#inspect(rules[1:8])
ruleSet = rbind(ruleSet, as(rules, "data.frame"))
```




```{r Association Rule Learning: WastingYoung}
set.seed(13)
#Pretty quick.
#Again, same as above two blocks except only conducted on WastingYoung data.
################################################################################
ruleSet[nrow(ruleSet)+1, 1] = "Wasting:"
data = data.frame(lapply(wasting, as.logical))


ruleSet[nrow(ruleSet)+1, 1] = "FEMALE:"
female = subset(data, Sex == TRUE)
female = female[,-2]
rules = apriori(female, 
                parameter = list(support = 0.01,
                                 confidence = 0.25,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Wasting")
                                  )
                )
#append(ruleSet, as(rules, "data.frame"))
#inspect(rules)
ruleSet = rbind(ruleSet, as(rules, "data.frame"))

ruleSet[nrow(ruleSet)+1, 1] = "MALE:"
male = subset(data, Sex == FALSE)
male = male[,-2]
rules = apriori(male, 
                parameter = list(support = 0.01,
                                 confidence = 0.35,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Wasting")
                                  )
                )
ruleSet = rbind(ruleSet, as(rules, "data.frame"))
################################################################################
#Rural & suburban vs. urban rules on Wasting
ruleSet[nrow(ruleSet)+1, 1] = "NOTURBAN:"
rural = subset(data, Urban == FALSE)
rural = rural[,-c(6)]
rules = apriori(rural,
                parameter = list(support = 0.01,
                                 confidence = 0.4,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Wasting")
                                  )
                )
#inspect(rules)
ruleSet = rbind(ruleSet, as(rules, "data.frame"))

ruleSet[nrow(ruleSet)+1, 1] = "URBAN:"
urban = subset(data, Urban == TRUE)
urban = urban[,-c(6)]
rules = apriori(urban, 
                parameter = list(support = 0.005,
                                 confidence = 0.23,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Wasting")
                                  )
                )
#inspect(rules[1:8])
ruleSet = rbind(ruleSet, as(rules, "data.frame"))
################################################################################
ruleSet[nrow(ruleSet)+1, 1] = "Wasting OVERALL:"
rules = apriori(data.frame(lapply(wasting, as.logical)), 
                parameter = list(support = 0.005,
                                 confidence = 0.25,
                                 maxlen = 4,
                                 target = "rules"),
                appearance = list(default = "lhs", rhs = c("Wasting")
                                  )
                )
#inspect(rules[1:10])
ruleSet = rbind(ruleSet, as(rules, "data.frame"))
################################################################################
write.csv(ruleSet, "Association_Rules.csv", row.names = FALSE)
```


